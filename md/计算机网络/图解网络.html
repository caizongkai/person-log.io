<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>图解网络 | Java 全栈知识体系</title>
    <meta name="description" content="包含: Java 基础, Java 部分源码, JVM, Spring, Spring Boot, Spring Cloud, 数据库原理, MySQL, ElasticSearch, MongoDB, Docker, k8s, CI&amp;CD, Linux, DevOps, 分布式, 中间件, 开发工具, Git, IDE, 源码阅读，读书笔记, 开源项目...">
    <link rel="icon" href="/person-log.io/images/photo.jpg">
  <link rel="manifest" href="/person-log.io/images/photo.jpg">
  <link rel="apple-touch-icon" href="/person-log.io/images/photo.jpg">
  <meta http-quiv="pragma" cotent="no-cache">
  <meta http-quiv="pragma" cotent="no-cache,must-revalidate">
  <meta http-quiv="expires" cotent="0">
    
    <link rel="preload" href="/person-log.io/assets/css/0.styles.4ff3082f.css" as="style"><link rel="preload" href="/person-log.io/assets/js/app.900e0138.js" as="script"><link rel="preload" href="/person-log.io/assets/js/2.143de871.js" as="script"><link rel="prefetch" href="/person-log.io/assets/js/10.5d3102c6.js"><link rel="prefetch" href="/person-log.io/assets/js/100.8abb6c0d.js"><link rel="prefetch" href="/person-log.io/assets/js/101.e70ee001.js"><link rel="prefetch" href="/person-log.io/assets/js/102.8eb6e9a9.js"><link rel="prefetch" href="/person-log.io/assets/js/103.4868ab00.js"><link rel="prefetch" href="/person-log.io/assets/js/104.1f3ae061.js"><link rel="prefetch" href="/person-log.io/assets/js/105.b4d44644.js"><link rel="prefetch" href="/person-log.io/assets/js/106.ed41d71f.js"><link rel="prefetch" href="/person-log.io/assets/js/107.99d8e0f9.js"><link rel="prefetch" href="/person-log.io/assets/js/108.b8cdbf75.js"><link rel="prefetch" href="/person-log.io/assets/js/109.e598b3d2.js"><link rel="prefetch" href="/person-log.io/assets/js/11.dd8a8a0d.js"><link rel="prefetch" href="/person-log.io/assets/js/110.45af1b3c.js"><link rel="prefetch" href="/person-log.io/assets/js/111.62ae94fd.js"><link rel="prefetch" href="/person-log.io/assets/js/112.b9434dad.js"><link rel="prefetch" href="/person-log.io/assets/js/113.377bbf43.js"><link rel="prefetch" href="/person-log.io/assets/js/114.5a6b7bd8.js"><link rel="prefetch" href="/person-log.io/assets/js/115.103372d3.js"><link rel="prefetch" href="/person-log.io/assets/js/116.43e77bfc.js"><link rel="prefetch" href="/person-log.io/assets/js/117.fc88e5e3.js"><link rel="prefetch" href="/person-log.io/assets/js/118.a169c7d0.js"><link rel="prefetch" href="/person-log.io/assets/js/119.4434297d.js"><link rel="prefetch" href="/person-log.io/assets/js/12.f6fdf928.js"><link rel="prefetch" href="/person-log.io/assets/js/120.ae5585ff.js"><link rel="prefetch" href="/person-log.io/assets/js/121.b7238501.js"><link rel="prefetch" href="/person-log.io/assets/js/122.3aa0028c.js"><link rel="prefetch" href="/person-log.io/assets/js/123.889610c6.js"><link rel="prefetch" href="/person-log.io/assets/js/124.2d9a318a.js"><link rel="prefetch" href="/person-log.io/assets/js/125.72b2c2f7.js"><link rel="prefetch" href="/person-log.io/assets/js/126.bd4ce6c8.js"><link rel="prefetch" href="/person-log.io/assets/js/13.5710e644.js"><link rel="prefetch" href="/person-log.io/assets/js/14.dd6c1cd0.js"><link rel="prefetch" href="/person-log.io/assets/js/15.7149798f.js"><link rel="prefetch" href="/person-log.io/assets/js/16.7bd52a2f.js"><link rel="prefetch" href="/person-log.io/assets/js/17.4daa4746.js"><link rel="prefetch" href="/person-log.io/assets/js/18.d4bdd6a7.js"><link rel="prefetch" href="/person-log.io/assets/js/19.95ddf026.js"><link rel="prefetch" href="/person-log.io/assets/js/20.615f1176.js"><link rel="prefetch" href="/person-log.io/assets/js/21.9d613190.js"><link rel="prefetch" href="/person-log.io/assets/js/22.eb619a13.js"><link rel="prefetch" href="/person-log.io/assets/js/23.70512efd.js"><link rel="prefetch" href="/person-log.io/assets/js/24.a299e3cc.js"><link rel="prefetch" href="/person-log.io/assets/js/25.e0bc91d9.js"><link rel="prefetch" href="/person-log.io/assets/js/26.bdd22671.js"><link rel="prefetch" href="/person-log.io/assets/js/27.6b7b12a6.js"><link rel="prefetch" href="/person-log.io/assets/js/28.d3ee9e71.js"><link rel="prefetch" href="/person-log.io/assets/js/29.3846b469.js"><link rel="prefetch" href="/person-log.io/assets/js/3.cd8ff11a.js"><link rel="prefetch" href="/person-log.io/assets/js/30.06463218.js"><link rel="prefetch" href="/person-log.io/assets/js/31.c52bcd52.js"><link rel="prefetch" href="/person-log.io/assets/js/32.aeb3a009.js"><link rel="prefetch" href="/person-log.io/assets/js/33.e9ece8bf.js"><link rel="prefetch" href="/person-log.io/assets/js/34.aa658d65.js"><link rel="prefetch" href="/person-log.io/assets/js/35.b0e6429a.js"><link rel="prefetch" href="/person-log.io/assets/js/36.11c95fd3.js"><link rel="prefetch" href="/person-log.io/assets/js/37.f6b7ce7c.js"><link rel="prefetch" href="/person-log.io/assets/js/38.2c0daf10.js"><link rel="prefetch" href="/person-log.io/assets/js/39.a2359299.js"><link rel="prefetch" href="/person-log.io/assets/js/4.f87d085e.js"><link rel="prefetch" href="/person-log.io/assets/js/40.67e9271b.js"><link rel="prefetch" href="/person-log.io/assets/js/41.b530b7d7.js"><link rel="prefetch" href="/person-log.io/assets/js/42.ceec96ec.js"><link rel="prefetch" href="/person-log.io/assets/js/43.1882528a.js"><link rel="prefetch" href="/person-log.io/assets/js/44.9c4e1af8.js"><link rel="prefetch" href="/person-log.io/assets/js/45.4ddef8e4.js"><link rel="prefetch" href="/person-log.io/assets/js/46.67313dc2.js"><link rel="prefetch" href="/person-log.io/assets/js/47.5c6b2c29.js"><link rel="prefetch" href="/person-log.io/assets/js/48.b7e57021.js"><link rel="prefetch" href="/person-log.io/assets/js/49.bff0de67.js"><link rel="prefetch" href="/person-log.io/assets/js/5.13ef03c9.js"><link rel="prefetch" href="/person-log.io/assets/js/50.0570550e.js"><link rel="prefetch" href="/person-log.io/assets/js/51.7e536feb.js"><link rel="prefetch" href="/person-log.io/assets/js/52.a011b658.js"><link rel="prefetch" href="/person-log.io/assets/js/53.c8ba3843.js"><link rel="prefetch" href="/person-log.io/assets/js/54.7ec121d9.js"><link rel="prefetch" href="/person-log.io/assets/js/55.516a38ec.js"><link rel="prefetch" href="/person-log.io/assets/js/56.62b2636e.js"><link rel="prefetch" href="/person-log.io/assets/js/57.b3111d41.js"><link rel="prefetch" href="/person-log.io/assets/js/58.4e4428b3.js"><link rel="prefetch" href="/person-log.io/assets/js/59.4bd160cb.js"><link rel="prefetch" href="/person-log.io/assets/js/6.246d68f0.js"><link rel="prefetch" href="/person-log.io/assets/js/60.147eae57.js"><link rel="prefetch" href="/person-log.io/assets/js/61.ece9faa7.js"><link rel="prefetch" href="/person-log.io/assets/js/62.42d5a03e.js"><link rel="prefetch" href="/person-log.io/assets/js/63.618c9a42.js"><link rel="prefetch" href="/person-log.io/assets/js/64.4a5e7887.js"><link rel="prefetch" href="/person-log.io/assets/js/65.e7fb9653.js"><link rel="prefetch" href="/person-log.io/assets/js/66.29e33acf.js"><link rel="prefetch" href="/person-log.io/assets/js/67.ce40420e.js"><link rel="prefetch" href="/person-log.io/assets/js/68.9ae9da96.js"><link rel="prefetch" href="/person-log.io/assets/js/69.798d9970.js"><link rel="prefetch" href="/person-log.io/assets/js/7.77d79df0.js"><link rel="prefetch" href="/person-log.io/assets/js/70.5ebe26ce.js"><link rel="prefetch" href="/person-log.io/assets/js/71.79a27be8.js"><link rel="prefetch" href="/person-log.io/assets/js/72.a4c84ae1.js"><link rel="prefetch" href="/person-log.io/assets/js/73.be2bf486.js"><link rel="prefetch" href="/person-log.io/assets/js/74.2e32e870.js"><link rel="prefetch" href="/person-log.io/assets/js/75.fbabbd25.js"><link rel="prefetch" href="/person-log.io/assets/js/76.ea1ba140.js"><link rel="prefetch" href="/person-log.io/assets/js/77.4ce215b3.js"><link rel="prefetch" href="/person-log.io/assets/js/78.4757c020.js"><link rel="prefetch" href="/person-log.io/assets/js/79.398d6895.js"><link rel="prefetch" href="/person-log.io/assets/js/8.f33fb86b.js"><link rel="prefetch" href="/person-log.io/assets/js/80.2913d38e.js"><link rel="prefetch" href="/person-log.io/assets/js/81.00d718fe.js"><link rel="prefetch" href="/person-log.io/assets/js/82.49baf639.js"><link rel="prefetch" href="/person-log.io/assets/js/83.0b255dec.js"><link rel="prefetch" href="/person-log.io/assets/js/84.aa39b1b8.js"><link rel="prefetch" href="/person-log.io/assets/js/85.220a5565.js"><link rel="prefetch" href="/person-log.io/assets/js/86.5381f000.js"><link rel="prefetch" href="/person-log.io/assets/js/87.55b5c1f1.js"><link rel="prefetch" href="/person-log.io/assets/js/88.f9d2f70c.js"><link rel="prefetch" href="/person-log.io/assets/js/89.d9463204.js"><link rel="prefetch" href="/person-log.io/assets/js/9.6dba6746.js"><link rel="prefetch" href="/person-log.io/assets/js/90.6b0a709d.js"><link rel="prefetch" href="/person-log.io/assets/js/91.4ae96144.js"><link rel="prefetch" href="/person-log.io/assets/js/92.b9357539.js"><link rel="prefetch" href="/person-log.io/assets/js/93.59c128af.js"><link rel="prefetch" href="/person-log.io/assets/js/94.1008960c.js"><link rel="prefetch" href="/person-log.io/assets/js/95.128fb549.js"><link rel="prefetch" href="/person-log.io/assets/js/96.d74f8117.js"><link rel="prefetch" href="/person-log.io/assets/js/97.afeacc56.js"><link rel="prefetch" href="/person-log.io/assets/js/98.4de04002.js"><link rel="prefetch" href="/person-log.io/assets/js/99.599f733a.js">
    <link rel="stylesheet" href="/person-log.io/assets/css/0.styles.4ff3082f.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/person-log.io/" class="home-link router-link-active"><!----> <span class="site-name">Java 全栈知识体系</span></a> <div class="links" style="max-width:nullpx;"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/person-log.io/md/" class="nav-link router-link-active">导读</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">Java</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/person-log.io/md/JAVA/" class="nav-link">JAVA基础</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">数据库</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/person-log.io/md/database/base/" class="nav-link">数据库基础</a></li><li class="dropdown-item"><!----> <a href="/person-log.io/md/database/Mysql/" class="nav-link">MySQL</a></li><li class="dropdown-item"><!----> <a href="/person-log.io/md/database/Redis/" class="nav-link">Redis</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">计算机网络</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/person-log.io/md/计算机网络/图解网络.html" class="nav-link">图解网络</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">项目部署</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/person-log.io/md/DevOps/Docker/" class="nav-link">Docker</a></li><li class="dropdown-item"><!----> <a href="/person-log.io/md/DevOps/jenkins/" class="nav-link">jenkins</a></li><li class="dropdown-item"><!----> <a href="/person-log.io/md/DevOps/consul-cluster/" class="nav-link">consul</a></li><li class="dropdown-item"><!----> <a href="/person-log.io/md/DevOps/Nginx/" class="nav-link">Nginx</a></li><li class="dropdown-item"><!----> <a href="/person-log.io/md/DevOps/Linux/" class="nav-link">Linux</a></li><li class="dropdown-item"><!----> <a href="/person-log.io/md/DevOps/blog/" class="nav-link">个人博客</a></li></ul></div></div> <a href="https://github.com/caizongkai/vuepressDemo" target="_blank" rel="noopener noreferrer" class="repo-link">
    修改文档
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav></div></header> <div class="sidebar-mask"></div> <div class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/person-log.io/md/" class="nav-link router-link-active">导读</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">Java</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/person-log.io/md/JAVA/" class="nav-link">JAVA基础</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">数据库</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/person-log.io/md/database/base/" class="nav-link">数据库基础</a></li><li class="dropdown-item"><!----> <a href="/person-log.io/md/database/Mysql/" class="nav-link">MySQL</a></li><li class="dropdown-item"><!----> <a href="/person-log.io/md/database/Redis/" class="nav-link">Redis</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">计算机网络</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/person-log.io/md/计算机网络/图解网络.html" class="nav-link">图解网络</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">项目部署</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/person-log.io/md/DevOps/Docker/" class="nav-link">Docker</a></li><li class="dropdown-item"><!----> <a href="/person-log.io/md/DevOps/jenkins/" class="nav-link">jenkins</a></li><li class="dropdown-item"><!----> <a href="/person-log.io/md/DevOps/consul-cluster/" class="nav-link">consul</a></li><li class="dropdown-item"><!----> <a href="/person-log.io/md/DevOps/Nginx/" class="nav-link">Nginx</a></li><li class="dropdown-item"><!----> <a href="/person-log.io/md/DevOps/Linux/" class="nav-link">Linux</a></li><li class="dropdown-item"><!----> <a href="/person-log.io/md/DevOps/blog/" class="nav-link">个人博客</a></li></ul></div></div> <a href="https://github.com/caizongkai/vuepressDemo" target="_blank" rel="noopener noreferrer" class="repo-link">
    修改文档
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav>  <ul class="sidebar-links"><li><div class="sidebar-group first"><p class="sidebar-heading open"><span>导航</span> <!----></p> <ul class="sidebar-group-items"><li><a href="/person-log.io/md/JAVA/" class="sidebar-link">JAVA</a></li><li><a href="/person-log.io/md/DevOps/" class="sidebar-link">项目部署</a></li></ul></div></li></ul> </div> <div class="page"> <div class="content"><h1 id="图解网络"><a href="#图解网络" class="header-anchor">#</a> 图解网络</h1> <h2 id="集线器"><a href="#集线器" class="header-anchor">#</a> 集线器</h2> <p>最初，我们要发送信息给一个电脑，我们需要用一根线把两个电脑连起来，就像下图：</p> <p><img src="/person-log.io/assets/img/image-20210128163351568.e4671354.png" alt="image-20210128163351568"></p> <p>但是当电脑越来越多，我们就无法通过这种方式将电脑两两连接起来，如下图：</p> <p><img src="/person-log.io/assets/img/image-20210128163539552.b6f854cf.png" alt="image-20210128163539552"></p> <p>于是我们就发明了<strong>集线器</strong>，把所有的电脑都连到一个设备上，然后通过这个设备做转发，如下图：</p> <p><img src="/person-log.io/assets/img/image-20210128163634171.ef9e2b0d.png" alt="image-20210128163634171"></p> <p>这样线就不会那么混乱了，<strong>集线器</strong>是直接将传入的电信号无脑转发到所有端口，不做任何处理，由于集线器智商太低，所以我们给他定义在<strong>物理层</strong>。就像下图：</p> <p><img src="/person-log.io/assets/img/640.04ec9b15.gif" alt="640"></p> <p>那么集线器没有做任何处理，电脑是如何知道这个信息是发给自己的呢？这个时候我们需要给电脑起一个唯一的名字，叫<strong>MAC地址</strong>。</p> <p>A的 MAC 地址是 aa-aa-aa-aa-aa-aa，你的伙伴 b 的 MAC 地址是 bb-bb-bb-bb-bb-bb，以此类推，不重复就好。</p> <p>这样，A 在发送数据包给 B 时，只要在头部拼接一个这样结构的数据，就可以了。</p> <p><img src="/person-log.io/assets/img/image-20210128164103327.6f4a8586.png" alt="image-20210128164103327"></p> <p>B 在收到数据包后，根据头部的目标 MAC 地址信息，判断这个数据包的确是发给自己的，于是便<strong>收下</strong>。</p> <p>其他的 CDE 收到数据包后，根据头部的目标 MAC 地址信息，判断这个数据包并不是发给自己的，于是便<strong>丢弃</strong>。</p> <p>但是这时候就出现了，其他电脑并不需要这个信息，但是还是会接收到信息的情况，那么这样不仅不安全，而且还浪费资源。那么有什么更好的办法可以解决呢？答案是<strong>交换机</strong>。</p> <h2 id="交换机"><a href="#交换机" class="header-anchor">#</a> 交换机</h2> <p>交换机比集线器更智能，<strong>只发给目标 MAC 地址指向的那台电脑</strong>。也正因为这一点点智能，你把它放在了另一个层级，<strong>数据链路层</strong>。</p> <p><img src="/person-log.io/assets/img/image-20210128164512793.7da1f307.png" alt="image-20210128164512793"></p> <p>如上图所示，你是这样设计的。</p> <p>交换机内部维护一张 <strong>MAC 地址表</strong>，记录着每一个 MAC 地址的设备，连接在其哪一个端口上。</p> <table><thead><tr><th style="text-align:center">MAC 地址</th> <th style="text-align:center">端口</th></tr></thead> <tbody><tr><td style="text-align:center">bb-bb-bb-bb-bb-bb</td> <td style="text-align:center">1</td></tr> <tr><td style="text-align:center">cc-cc-cc-cc-cc-cc</td> <td style="text-align:center">3</td></tr> <tr><td style="text-align:center">aa-aa-aa-aa-aa-aa</td> <td style="text-align:center">4</td></tr> <tr><td style="text-align:center">dd-dd-dd-dd-dd-dd</td> <td style="text-align:center">5</td></tr></tbody></table> <p>假如你仍然要发给 B 一个数据包，构造了如下的数据结构从网口出去。</p> <p><img src="/person-log.io/assets/img/image-20210128164614202.30a122be.png" alt="image-20210128164614202"></p> <p>到达交换机时，交换机内部通过自己维护的 MAC 地址表，发现<strong>目标机器 B 的 MAC 地址 bb-bb-bb-bb-bb-bb 映射到了端口 1 上</strong>，于是把数据从 1 号端口发给了 B，完事~</p> <p>你给这个通过这样传输方式而组成的小范围的网络，叫做<strong>以太网</strong>。</p> <p>当然最开始的时候，MAC 地址表是空的，是怎么逐步建立起来的呢？</p> <p>首先这个包由A进入到交换机，那么我们就知道了A的端口和MAC地址的映射信息，我们就在MAC表中记录A的信息。然后由于在MAC表中无法找到目表MAC地址，这时候交换机会进行广播，将该包发送到所有端口，这时候只有B收到并且做出响应，这时候交换机就知道B的MAC地址，并将他记录到交换机的MAC表中。过程如下</p> <p>![640 (1)](图解网络.assets/640 (1).gif)</p> <p>随着机器数量越多，交换机的端口也不够了，但聪明的你发现，只要将多个交换机连接起来，这个问题就轻而易举搞定~</p> <p><img src="/person-log.io/assets/img/image-20210128165207389.7fe493ba.png" alt="image-20210128165207389"></p> <p><strong>左边的交换机</strong></p> <table><thead><tr><th style="text-align:center">MAC 地址</th> <th style="text-align:center">端口</th></tr></thead> <tbody><tr><td style="text-align:center">bb-bb-bb-bb-bb-bb</td> <td style="text-align:center">1</td></tr> <tr><td style="text-align:center">cc-cc-cc-cc-cc-cc</td> <td style="text-align:center">3</td></tr> <tr><td style="text-align:center">aa-aa-aa-aa-aa-aa</td> <td style="text-align:center">4</td></tr> <tr><td style="text-align:center">dd-dd-dd-dd-dd-dd</td> <td style="text-align:center">5</td></tr> <tr><td style="text-align:center">ee-ee-ee-ee-ee-ee</td> <td style="text-align:center">6</td></tr> <tr><td style="text-align:center">ff-ff-ff-ff-ff-ff</td> <td style="text-align:center">6</td></tr> <tr><td style="text-align:center">gg-gg-gg-gg-gg-gg</td> <td style="text-align:center">6</td></tr> <tr><td style="text-align:center">hh-hh-hh-hh-hh-hh</td> <td style="text-align:center">6</td></tr></tbody></table> <p><strong>右边的交换机</strong></p> <table><thead><tr><th style="text-align:center">MAC 地址</th> <th style="text-align:center">端口</th></tr></thead> <tbody><tr><td style="text-align:center">bb-bb-bb-bb-bb-bb</td> <td style="text-align:center">1</td></tr> <tr><td style="text-align:center">cc-cc-cc-cc-cc-cc</td> <td style="text-align:center">1</td></tr> <tr><td style="text-align:center">aa-aa-aa-aa-aa-aa</td> <td style="text-align:center">1</td></tr> <tr><td style="text-align:center">dd-dd-dd-dd-dd-dd</td> <td style="text-align:center">1</td></tr> <tr><td style="text-align:center">ee-ee-ee-ee-ee-ee</td> <td style="text-align:center">2</td></tr> <tr><td style="text-align:center">ff-ff-ff-ff-ff-ff</td> <td style="text-align:center">3</td></tr> <tr><td style="text-align:center">gg-gg-gg-gg-gg-gg</td> <td style="text-align:center">4</td></tr> <tr><td style="text-align:center">hh-hh-hh-hh-hh-hh</td> <td style="text-align:center">6</td></tr></tbody></table> <p>但是很快，电脑越来越多，这种方式也不适用了，那么这个时候<strong>路由器</strong>出现了。</p> <h2 id="路由器"><a href="#路由器" class="header-anchor">#</a> 路由器</h2> <p>那我可不可以让那根红色的网线，接入一个<strong>新的设备</strong>，这个设备就跟电脑一样有自己独立的 MAC 地址，而且同时还能帮我把数据包做一次<strong>转发</strong>呢？这个设备就是<strong>路由器，<strong>它的功能就是，作为一台独立的拥有 MAC 地址的设备，并且可以帮我把数据包做一次转发</strong>，<strong>你把它定在了</strong>网络层。</strong></p> <p><img src="/person-log.io/assets/img/image-20210128165439199.642a07ed.png" alt="image-20210128165439199"></p> <p>注意，路由器的每一个端口，都有独立的 MAC 地址</p> <p>那么如上图，路由器是怎么做到将A的包发送给B和C呢，这个时候单纯通过MAC地址是无法实现的。因为你无法通过MAC地址知道两台电脑是否连到同一个交换机上。这个时候我们就需要引入一个编号，来确定两台电脑是不是连接到同一台交换机上，这个编号有32位，如：<strong>11000000101010000000000000000001</strong></p> <p>你觉得有些不清晰，于是把它分成四个部分，中间用点相连。</p> <p><strong>11000000.10101000.00000000.00000001</strong></p> <p>你还觉得不清晰，于是把它转换成 10 进制。</p> <p><strong>192.168.0.1</strong></p> <p>最后你给了这个地址一个响亮的名字，<strong>IP 地址</strong>。现在每一台电脑，同时有自己的 MAC 地址，又有自己的 IP 地址，只不过 IP 地址是<strong>软件层面</strong>上的，可以随时修改，MAC 地址一般是无法修改的。</p> <h3 id="子网"><a href="#子网" class="header-anchor">#</a> 子网</h3> <p>这时你如何判断两台电脑是否连到同一台交换机上呢？我们称连在同一台交换机上的计算机属于同一个<strong>子网</strong>。那么如何判断计算机是否连在同一个子网上呢？人们发明了<strong>子网掩码</strong>的概念，即将IP地址和子网掩码做与运算，如果与运算的结果相等，那么我们就说这两台计算机在同一个子网，假如某台机器的子网掩码定为 255.255.255.0，比如</p> <ul><li><strong>A电脑</strong>：192.168.0.1 &amp; 255.255.255.0 = 192.168.0.0</li> <li><strong>B电脑</strong>：192.168.0.2 &amp; 255.255.255.0 = 192.168.0.0</li> <li><strong>C电脑</strong>：192.168.1.1 &amp; 255.255.255.0 = 192.168.1.0</li> <li><strong>D电脑</strong>：192.168.1.2 &amp; 255.255.255.0 = 192.168.1.0</li></ul> <p>那么 A 与 B 在同一个子网，C 与 D 在同一个子网，但是 A 与 C 就不在同一个子网，与 D 也不在同一个子网，以此类推。子网掩码其实是确定ip地址前几位相同就将他定义为在同一个子网。</p> <p><img src="/person-log.io/assets/img/image-20210128170652931.33e0c407.png" alt="image-20210128170652931"></p> <p>那么现在网络拓扑图如上，这个时候A给B发信息，我们除了需要在包上加上数据链路层的头部之外，还需要再增加一个网络层的头部。</p> <p><img src="/person-log.io/assets/img/image-20210128170850889.466b0c9d.png" alt="image-20210128170850889"></p> <p>但假如 A 给 C 发送数据，A 就需要先转交给路由器，然后再由路由器转交给 C。由于最底层的传输仍然需要依赖以太网，所以数据包是分成两段的。</p> <p>A ~ 路由器这段的包如下：</p> <p><img src="/person-log.io/assets/img/image-20210128170923690.6d831a0f.png" alt="image-20210128170923690"></p> <p>路由器到 C 这段的包如下：</p> <p><img src="/person-log.io/assets/img/image-20210128170949947.e2e1cf95.png" alt="image-20210128170949947"></p> <p>因为A给B发送信息时，发现A和B在同一子网，那么这时候A将包丢给交换机，然后交换机转发包给B，如何转发可以看交换机那一部分。</p> <p>当A给C发送信息时，发现A和C不在同一子网，那么这时候我们就要通过交换机把包先丢给路由器，那么这时候我们怎么知道哪个是路由器呢？那么另一个概念就来了，就是<strong>默认网关</strong>。</p> <h3 id="默认网关"><a href="#默认网关" class="header-anchor">#</a> 默认网关</h3> <p>前面我们说了，路由器是相当于一个电脑的，当源IP地址跟目标IP地址不在同一子网，那么这时候我们需要告诉发送包的电脑哪个是路由器，这个路由器有一个IP地址，叫做<strong>默认网关</strong>。这时候上面的网络拓扑图如下：</p> <p><img src="/person-log.io/assets/img/image-20210128171808106.879de3a6.png" alt="image-20210128171808106"></p> <p>当A给C发送包时，发现A和C不在同一子网，那么这时候A就把包丢给默认网关，也就是路由器，但是交换机需要知道路由器的MAC地址才能将包发送给路由器，那么只知道我的目标IP地址，怎么让交换机把包发送到目的地呢？答案是<strong>arp</strong>。</p> <h3 id="arp协议"><a href="#arp协议" class="header-anchor">#</a> arp协议</h3> <p>电脑里面有一张 <strong>arp 缓存表</strong>,有一张 <strong>arp 缓存表</strong></p> <table><thead><tr><th style="text-align:center">IP 地址</th> <th style="text-align:center">MAC 地址</th></tr></thead> <tbody><tr><td style="text-align:center">192.168.0.254</td> <td style="text-align:center">ABAB</td></tr></tbody></table> <p>一开始的时候这个表是<strong>空的</strong>，电脑 A 为了知道路由器（192.168.0.254 ）的 MAC 地址，将会<strong>广播</strong>一条 arp 请求，路由器收到请求后，带上自己的 MAC 地址给 A 一个<strong>响应</strong>。此时 A 便更新了自己的 arp 表。这样通过大家不断广播 arp 请求，最终所有电脑里面都将 arp 缓存表更新完整。</p> <p>此时包就成功丢到了路由器上了。那么路由器是如何将包发出去的呢？答案是通过<strong>路由表</strong>。</p> <h3 id="路由表"><a href="#路由表" class="header-anchor">#</a> 路由表</h3> <p>路由器收到的数据包有目的 IP 也就是 C 的 IP 地址，需要转化成从自己的哪个端口出去，很容易想到，应该有个表，就像 MAC 地址表一样。</p> <p>不同于 MAC 地址表的是，路由表并不是一对一这种明确关系，我们下面看一个路由表的结构。</p> <table><thead><tr><th style="text-align:center">目的地址</th> <th style="text-align:center">子网掩码</th> <th style="text-align:center">下一跳</th> <th style="text-align:center">端口</th></tr></thead> <tbody><tr><td style="text-align:center">192.168.0.0</td> <td style="text-align:center">255.255.255.0</td> <td style="text-align:center"></td> <td style="text-align:center">0</td></tr> <tr><td style="text-align:center">192.168.0.254</td> <td style="text-align:center">255.255.255.255</td> <td style="text-align:center"></td> <td style="text-align:center">0</td></tr> <tr><td style="text-align:center">192.168.1.0</td> <td style="text-align:center">255.255.255.0</td> <td style="text-align:center"></td> <td style="text-align:center">1</td></tr> <tr><td style="text-align:center">192.168.1.254</td> <td style="text-align:center">255.255.255.255</td> <td style="text-align:center"></td> <td style="text-align:center">1</td></tr></tbody></table> <p>我们学习一种新的表示方法，由于子网掩码其实就表示前多少位表示子网的网段，所以如 192.168.0.0（255.255.255.0） 也可以简写为 192.168.0.0/24</p> <table><thead><tr><th style="text-align:center">目的地址</th> <th style="text-align:center">下一跳</th> <th style="text-align:center">端口</th></tr></thead> <tbody><tr><td style="text-align:center">192.168.0.0/24</td> <td style="text-align:center"></td> <td style="text-align:center">0</td></tr> <tr><td style="text-align:center">192.168.0.254/32</td> <td style="text-align:center"></td> <td style="text-align:center">0</td></tr> <tr><td style="text-align:center">192.168.1.0/24</td> <td style="text-align:center"></td> <td style="text-align:center">1</td></tr> <tr><td style="text-align:center">192.168.1.254/32</td> <td style="text-align:center"></td> <td style="text-align:center">1</td></tr></tbody></table> <p>通过路由表，路由器收到了来自A的包，然后知道目标的ip地址，那么路由器就会将包发送给目标ip的交换机，通过查路由表就知道这个包需要从哪个端口发出去，当无法查到对应的子网，那么就会通过下一跳去各种检索，这个我也不太懂，就不展开讲了~然后最后发现还是无法找到目标ip地址的交换机，就会超时，包不可达。</p> <p>但是如上面的示例，路由器通过查路由表可以找到目标IP的子网交换机，这个时候就会将包通过对应端口转发出去，这时候交换机收到来自路由器的包，通过MAC地址表将包丢给目标电脑。</p> <h1 id="总结一下"><a href="#总结一下" class="header-anchor">#</a> <strong>总结一下</strong></h1> <p>好了，总结一下，到目前为止就几条规则</p> <p><strong>从各个节点的视角来看</strong></p> <p><strong>电脑视角</strong>：</p> <ul><li>首先我要知道我的 IP 以及对方的 IP</li> <li>通过子网掩码判断我们是否在同一个子网</li> <li>在同一个子网就通过 arp 获取对方 mac 地址直接扔出去</li> <li>不在同一个子网就通过 arp 获取默认网关的 mac 地址直接扔出去</li></ul> <p><strong>交换机视角：</strong></p> <ul><li>我收到的数据包必须有目标 MAC 地址</li> <li>通过 MAC 地址表查映射关系</li> <li>查到了就按照映射关系从我的指定端口发出去</li> <li>查不到就所有端口都发出去</li></ul> <p><strong>路由器视角：</strong></p> <ul><li>我收到的数据包必须有目标 IP 地址</li> <li>通过路由表查映射关系</li> <li>查到了就按照映射关系从我的指定端口发出去（不在任何一个子网范围，走其路由器的默认网关也是查到了）</li> <li>查不到则返回一个路由不可达的数据包</li></ul> <p>如果你嗅觉足够敏锐，你应该可以感受到下面这句话：</p> <p>网络层（IP协议）本身没有传输包的功能，包的实际传输是委托给数据链路层（以太网中的交换机）来实现的。</p> <p><strong>涉及到的三张表分别是</strong></p> <ul><li>交换机中有 <strong>MAC 地址</strong>表用于映射 MAC 地址和它的端口</li> <li>路由器中有<strong>路由表</strong>用于映射 IP 地址(段)和它的端口</li> <li>电脑和路由器中都有 <strong>arp 缓存表</strong>用于缓存 IP 和 MAC 地址的映射关系</li></ul> <p><strong>这三张表是怎么来的</strong></p> <ul><li>MAC 地址表是通过以太网内各节点之间不断通过交换机通信，不断完善起来的。</li> <li>路由表是各种路由算法 + 人工配置逐步完善起来的。</li> <li>arp 缓存表是不断通过 arp 协议的请求逐步完善起来的。</li></ul></div> <div class="page-edit"><div class="edit-link"><a href="https://github.com/caizongkai/vuepressDemo/edit/main/docs/md/计算机网络/图解网络.md" target="_blank" rel="noopener noreferrer">帮助我们改善此页面！</a> <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></div> <!----></div> <!----> </div> <!----></div></div>
    <script src="/person-log.io/assets/js/app.900e0138.js" defer></script><script src="/person-log.io/assets/js/2.143de871.js" defer></script>
  </body>
</html>
