<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>RDB持久化 | Java 全栈知识体系</title>
    <meta name="description" content="包含: Java 基础, Java 部分源码, JVM, Spring, Spring Boot, Spring Cloud, 数据库原理, MySQL, ElasticSearch, MongoDB, Docker, k8s, CI&amp;CD, Linux, DevOps, 分布式, 中间件, 开发工具, Git, IDE, 源码阅读，读书笔记, 开源项目...">
    <link rel="icon" href="/person-log.io/images/photo.jpg">
  <link rel="manifest" href="/person-log.io/images/photo.jpg">
  <link rel="apple-touch-icon" href="/person-log.io/images/photo.jpg">
  <meta http-quiv="pragma" cotent="no-cache">
  <meta http-quiv="pragma" cotent="no-cache,must-revalidate">
  <meta http-quiv="expires" cotent="0">
    
    <link rel="preload" href="/person-log.io/assets/css/0.styles.4ff3082f.css" as="style"><link rel="preload" href="/person-log.io/assets/js/app.900e0138.js" as="script"><link rel="preload" href="/person-log.io/assets/js/18.d4bdd6a7.js" as="script"><link rel="prefetch" href="/person-log.io/assets/js/10.5d3102c6.js"><link rel="prefetch" href="/person-log.io/assets/js/100.8abb6c0d.js"><link rel="prefetch" href="/person-log.io/assets/js/101.e70ee001.js"><link rel="prefetch" href="/person-log.io/assets/js/102.8eb6e9a9.js"><link rel="prefetch" href="/person-log.io/assets/js/103.4868ab00.js"><link rel="prefetch" href="/person-log.io/assets/js/104.1f3ae061.js"><link rel="prefetch" href="/person-log.io/assets/js/105.b4d44644.js"><link rel="prefetch" href="/person-log.io/assets/js/106.ed41d71f.js"><link rel="prefetch" href="/person-log.io/assets/js/107.99d8e0f9.js"><link rel="prefetch" href="/person-log.io/assets/js/108.b8cdbf75.js"><link rel="prefetch" href="/person-log.io/assets/js/109.e598b3d2.js"><link rel="prefetch" href="/person-log.io/assets/js/11.dd8a8a0d.js"><link rel="prefetch" href="/person-log.io/assets/js/110.45af1b3c.js"><link rel="prefetch" href="/person-log.io/assets/js/111.62ae94fd.js"><link rel="prefetch" href="/person-log.io/assets/js/112.b9434dad.js"><link rel="prefetch" href="/person-log.io/assets/js/113.377bbf43.js"><link rel="prefetch" href="/person-log.io/assets/js/114.5a6b7bd8.js"><link rel="prefetch" href="/person-log.io/assets/js/115.103372d3.js"><link rel="prefetch" href="/person-log.io/assets/js/116.43e77bfc.js"><link rel="prefetch" href="/person-log.io/assets/js/117.fc88e5e3.js"><link rel="prefetch" href="/person-log.io/assets/js/118.a169c7d0.js"><link rel="prefetch" href="/person-log.io/assets/js/119.4434297d.js"><link rel="prefetch" href="/person-log.io/assets/js/12.f6fdf928.js"><link rel="prefetch" href="/person-log.io/assets/js/120.ae5585ff.js"><link rel="prefetch" href="/person-log.io/assets/js/121.b7238501.js"><link rel="prefetch" href="/person-log.io/assets/js/122.3aa0028c.js"><link rel="prefetch" href="/person-log.io/assets/js/123.889610c6.js"><link rel="prefetch" href="/person-log.io/assets/js/124.2d9a318a.js"><link rel="prefetch" href="/person-log.io/assets/js/125.72b2c2f7.js"><link rel="prefetch" href="/person-log.io/assets/js/126.bd4ce6c8.js"><link rel="prefetch" href="/person-log.io/assets/js/13.5710e644.js"><link rel="prefetch" href="/person-log.io/assets/js/14.dd6c1cd0.js"><link rel="prefetch" href="/person-log.io/assets/js/15.7149798f.js"><link rel="prefetch" href="/person-log.io/assets/js/16.7bd52a2f.js"><link rel="prefetch" href="/person-log.io/assets/js/17.4daa4746.js"><link rel="prefetch" href="/person-log.io/assets/js/19.95ddf026.js"><link rel="prefetch" href="/person-log.io/assets/js/2.143de871.js"><link rel="prefetch" href="/person-log.io/assets/js/20.615f1176.js"><link rel="prefetch" href="/person-log.io/assets/js/21.9d613190.js"><link rel="prefetch" href="/person-log.io/assets/js/22.eb619a13.js"><link rel="prefetch" href="/person-log.io/assets/js/23.70512efd.js"><link rel="prefetch" href="/person-log.io/assets/js/24.a299e3cc.js"><link rel="prefetch" href="/person-log.io/assets/js/25.e0bc91d9.js"><link rel="prefetch" href="/person-log.io/assets/js/26.bdd22671.js"><link rel="prefetch" href="/person-log.io/assets/js/27.6b7b12a6.js"><link rel="prefetch" href="/person-log.io/assets/js/28.d3ee9e71.js"><link rel="prefetch" href="/person-log.io/assets/js/29.3846b469.js"><link rel="prefetch" href="/person-log.io/assets/js/3.cd8ff11a.js"><link rel="prefetch" href="/person-log.io/assets/js/30.06463218.js"><link rel="prefetch" href="/person-log.io/assets/js/31.c52bcd52.js"><link rel="prefetch" href="/person-log.io/assets/js/32.aeb3a009.js"><link rel="prefetch" href="/person-log.io/assets/js/33.e9ece8bf.js"><link rel="prefetch" href="/person-log.io/assets/js/34.aa658d65.js"><link rel="prefetch" href="/person-log.io/assets/js/35.b0e6429a.js"><link rel="prefetch" href="/person-log.io/assets/js/36.11c95fd3.js"><link rel="prefetch" href="/person-log.io/assets/js/37.f6b7ce7c.js"><link rel="prefetch" href="/person-log.io/assets/js/38.2c0daf10.js"><link rel="prefetch" href="/person-log.io/assets/js/39.a2359299.js"><link rel="prefetch" href="/person-log.io/assets/js/4.f87d085e.js"><link rel="prefetch" href="/person-log.io/assets/js/40.67e9271b.js"><link rel="prefetch" href="/person-log.io/assets/js/41.b530b7d7.js"><link rel="prefetch" href="/person-log.io/assets/js/42.ceec96ec.js"><link rel="prefetch" href="/person-log.io/assets/js/43.1882528a.js"><link rel="prefetch" href="/person-log.io/assets/js/44.9c4e1af8.js"><link rel="prefetch" href="/person-log.io/assets/js/45.4ddef8e4.js"><link rel="prefetch" href="/person-log.io/assets/js/46.67313dc2.js"><link rel="prefetch" href="/person-log.io/assets/js/47.5c6b2c29.js"><link rel="prefetch" href="/person-log.io/assets/js/48.b7e57021.js"><link rel="prefetch" href="/person-log.io/assets/js/49.bff0de67.js"><link rel="prefetch" href="/person-log.io/assets/js/5.13ef03c9.js"><link rel="prefetch" href="/person-log.io/assets/js/50.0570550e.js"><link rel="prefetch" href="/person-log.io/assets/js/51.7e536feb.js"><link rel="prefetch" href="/person-log.io/assets/js/52.a011b658.js"><link rel="prefetch" href="/person-log.io/assets/js/53.c8ba3843.js"><link rel="prefetch" href="/person-log.io/assets/js/54.7ec121d9.js"><link rel="prefetch" href="/person-log.io/assets/js/55.516a38ec.js"><link rel="prefetch" href="/person-log.io/assets/js/56.62b2636e.js"><link rel="prefetch" href="/person-log.io/assets/js/57.b3111d41.js"><link rel="prefetch" href="/person-log.io/assets/js/58.4e4428b3.js"><link rel="prefetch" href="/person-log.io/assets/js/59.4bd160cb.js"><link rel="prefetch" href="/person-log.io/assets/js/6.246d68f0.js"><link rel="prefetch" href="/person-log.io/assets/js/60.147eae57.js"><link rel="prefetch" href="/person-log.io/assets/js/61.ece9faa7.js"><link rel="prefetch" href="/person-log.io/assets/js/62.42d5a03e.js"><link rel="prefetch" href="/person-log.io/assets/js/63.618c9a42.js"><link rel="prefetch" href="/person-log.io/assets/js/64.4a5e7887.js"><link rel="prefetch" href="/person-log.io/assets/js/65.e7fb9653.js"><link rel="prefetch" href="/person-log.io/assets/js/66.29e33acf.js"><link rel="prefetch" href="/person-log.io/assets/js/67.ce40420e.js"><link rel="prefetch" href="/person-log.io/assets/js/68.9ae9da96.js"><link rel="prefetch" href="/person-log.io/assets/js/69.798d9970.js"><link rel="prefetch" href="/person-log.io/assets/js/7.77d79df0.js"><link rel="prefetch" href="/person-log.io/assets/js/70.5ebe26ce.js"><link rel="prefetch" href="/person-log.io/assets/js/71.79a27be8.js"><link rel="prefetch" href="/person-log.io/assets/js/72.a4c84ae1.js"><link rel="prefetch" href="/person-log.io/assets/js/73.be2bf486.js"><link rel="prefetch" href="/person-log.io/assets/js/74.2e32e870.js"><link rel="prefetch" href="/person-log.io/assets/js/75.fbabbd25.js"><link rel="prefetch" href="/person-log.io/assets/js/76.ea1ba140.js"><link rel="prefetch" href="/person-log.io/assets/js/77.4ce215b3.js"><link rel="prefetch" href="/person-log.io/assets/js/78.4757c020.js"><link rel="prefetch" href="/person-log.io/assets/js/79.398d6895.js"><link rel="prefetch" href="/person-log.io/assets/js/8.f33fb86b.js"><link rel="prefetch" href="/person-log.io/assets/js/80.2913d38e.js"><link rel="prefetch" href="/person-log.io/assets/js/81.00d718fe.js"><link rel="prefetch" href="/person-log.io/assets/js/82.49baf639.js"><link rel="prefetch" href="/person-log.io/assets/js/83.0b255dec.js"><link rel="prefetch" href="/person-log.io/assets/js/84.aa39b1b8.js"><link rel="prefetch" href="/person-log.io/assets/js/85.220a5565.js"><link rel="prefetch" href="/person-log.io/assets/js/86.5381f000.js"><link rel="prefetch" href="/person-log.io/assets/js/87.55b5c1f1.js"><link rel="prefetch" href="/person-log.io/assets/js/88.f9d2f70c.js"><link rel="prefetch" href="/person-log.io/assets/js/89.d9463204.js"><link rel="prefetch" href="/person-log.io/assets/js/9.6dba6746.js"><link rel="prefetch" href="/person-log.io/assets/js/90.6b0a709d.js"><link rel="prefetch" href="/person-log.io/assets/js/91.4ae96144.js"><link rel="prefetch" href="/person-log.io/assets/js/92.b9357539.js"><link rel="prefetch" href="/person-log.io/assets/js/93.59c128af.js"><link rel="prefetch" href="/person-log.io/assets/js/94.1008960c.js"><link rel="prefetch" href="/person-log.io/assets/js/95.128fb549.js"><link rel="prefetch" href="/person-log.io/assets/js/96.d74f8117.js"><link rel="prefetch" href="/person-log.io/assets/js/97.afeacc56.js"><link rel="prefetch" href="/person-log.io/assets/js/98.4de04002.js"><link rel="prefetch" href="/person-log.io/assets/js/99.599f733a.js">
    <link rel="stylesheet" href="/person-log.io/assets/css/0.styles.4ff3082f.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/person-log.io/" class="home-link router-link-active"><!----> <span class="site-name">Java 全栈知识体系</span></a> <div class="links" style="max-width:nullpx;"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/person-log.io/md/" class="nav-link router-link-active">导读</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">Java</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/person-log.io/md/JAVA/" class="nav-link">JAVA基础</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">数据库</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/person-log.io/md/database/base/" class="nav-link">数据库基础</a></li><li class="dropdown-item"><!----> <a href="/person-log.io/md/database/Mysql/" class="nav-link">MySQL</a></li><li class="dropdown-item"><!----> <a href="/person-log.io/md/database/Redis/" class="nav-link router-link-active">Redis</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">计算机网络</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/person-log.io/md/计算机网络/图解网络.html" class="nav-link">图解网络</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">项目部署</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/person-log.io/md/DevOps/Docker/" class="nav-link">Docker</a></li><li class="dropdown-item"><!----> <a href="/person-log.io/md/DevOps/jenkins/" class="nav-link">jenkins</a></li><li class="dropdown-item"><!----> <a href="/person-log.io/md/DevOps/consul-cluster/" class="nav-link">consul</a></li><li class="dropdown-item"><!----> <a href="/person-log.io/md/DevOps/Nginx/" class="nav-link">Nginx</a></li><li class="dropdown-item"><!----> <a href="/person-log.io/md/DevOps/Linux/" class="nav-link">Linux</a></li><li class="dropdown-item"><!----> <a href="/person-log.io/md/DevOps/blog/" class="nav-link">个人博客</a></li></ul></div></div> <a href="https://github.com/caizongkai/vuepressDemo" target="_blank" rel="noopener noreferrer" class="repo-link">
    修改文档
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav></div></header> <div class="sidebar-mask"></div> <div class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/person-log.io/md/" class="nav-link router-link-active">导读</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">Java</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/person-log.io/md/JAVA/" class="nav-link">JAVA基础</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">数据库</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/person-log.io/md/database/base/" class="nav-link">数据库基础</a></li><li class="dropdown-item"><!----> <a href="/person-log.io/md/database/Mysql/" class="nav-link">MySQL</a></li><li class="dropdown-item"><!----> <a href="/person-log.io/md/database/Redis/" class="nav-link router-link-active">Redis</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">计算机网络</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/person-log.io/md/计算机网络/图解网络.html" class="nav-link">图解网络</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">项目部署</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/person-log.io/md/DevOps/Docker/" class="nav-link">Docker</a></li><li class="dropdown-item"><!----> <a href="/person-log.io/md/DevOps/jenkins/" class="nav-link">jenkins</a></li><li class="dropdown-item"><!----> <a href="/person-log.io/md/DevOps/consul-cluster/" class="nav-link">consul</a></li><li class="dropdown-item"><!----> <a href="/person-log.io/md/DevOps/Nginx/" class="nav-link">Nginx</a></li><li class="dropdown-item"><!----> <a href="/person-log.io/md/DevOps/Linux/" class="nav-link">Linux</a></li><li class="dropdown-item"><!----> <a href="/person-log.io/md/DevOps/blog/" class="nav-link">个人博客</a></li></ul></div></div> <a href="https://github.com/caizongkai/vuepressDemo" target="_blank" rel="noopener noreferrer" class="repo-link">
    修改文档
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav>  <ul class="sidebar-links"><li><div class="sidebar-group first"><p class="sidebar-heading"><span>数据库基础</span> <!----></p> <ul class="sidebar-group-items"><li><a href="/person-log.io/md/database/base/04-数据库核心知识点.html" class="sidebar-link">数据库核心知识点</a></li></ul></div></li><li><div class="sidebar-group"><p class="sidebar-heading"><span>MySQL</span> <!----></p> <ul class="sidebar-group-items"><li><a href="/person-log.io/md/database/Mysql/MySQL-01-数据类型.html" class="sidebar-link">数据类型</a></li><li><a href="/person-log.io/md/database/Mysql/MySQL-02-存储引擎.html" class="sidebar-link">存储引擎</a></li><li><a href="/person-log.io/md/database/Mysql/MySQL-03-索引.html" class="sidebar-link">索引</a></li><li><a href="/person-log.io/md/database/Mysql/MySQL-04-优化.html" class="sidebar-link">优化</a></li><li><a href="/person-log.io/md/database/Mysql/MySQL-07-一条SQL的执行过程详解.html" class="sidebar-link">一条SQL的执行过程详解</a></li></ul></div></li><li><div class="sidebar-group"><p class="sidebar-heading open"><span>Redis</span> <!----></p> <ul class="sidebar-group-items"><li><a href="/person-log.io/md/database/Redis/" aria-current="page" class="sidebar-link">Redis知识体系详解</a></li><li><a href="/person-log.io/md/database/Redis/数据结构与对象/Redis-01-SDS.html" class="sidebar-link">Redis数据结构-SDS</a></li><li><a href="/person-log.io/md/database/Redis/数据结构与对象/Redis-02-链表.html" class="sidebar-link">Redis数据结构-链表</a></li><li><a href="/person-log.io/md/database/Redis/数据结构与对象/Redis-03-字典.html" class="sidebar-link">Redis数据结构-字典</a></li><li><a href="/person-log.io/md/database/Redis/数据结构与对象/Redis-04-跳跃表.html" class="sidebar-link">Redis数据结构-跳跃表</a></li><li><a href="/person-log.io/md/database/Redis/数据结构与对象/Redis-05-整数集合.html" class="sidebar-link">Redis数据结构-整数集合</a></li><li><a href="/person-log.io/md/database/Redis/数据结构与对象/Redis-06-压缩列表.html" class="sidebar-link">Redis数据结构-压缩列表</a></li><li><a href="/person-log.io/md/database/Redis/数据结构与对象/Redis-07-对象.html" class="sidebar-link">Redis对象</a></li><li><a href="/person-log.io/md/database/Redis/one-Redis/Redis-01-数据库.html" class="sidebar-link">Redis数据库</a></li><li><a href="/person-log.io/md/database/Redis/one-Redis/Redis-02-RDB.html" aria-current="page" class="active sidebar-link">RDB</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/person-log.io/md/database/Redis/one-Redis/Redis-02-RDB.html#rdb文件的创建与载入" class="sidebar-link">RDB文件的创建与载入</a></li><li class="sidebar-sub-header"><a href="/person-log.io/md/database/Redis/one-Redis/Redis-02-RDB.html#rdb文件结构" class="sidebar-link">RDB文件结构</a></li></ul></li><li><a href="/person-log.io/md/database/Redis/one-Redis/Redis-03-AOF.html" class="sidebar-link">AOF</a></li><li><a href="/person-log.io/md/database/Redis/one-Redis/Redis-04-事件.html" class="sidebar-link">事件</a></li><li><a href="/person-log.io/md/database/Redis/multi-redis/Redis-01-主从复制.html" class="sidebar-link">主从复制</a></li><li><a href="/person-log.io/md/database/Redis/multi-redis/Redis-02-哨兵机制.html" class="sidebar-link">哨兵机制</a></li><li><a href="/person-log.io/md/database/Redis/redis-install.html" class="sidebar-link">redis实战-redis安装</a></li><li><a href="/person-log.io/md/database/Redis/redis-sentinel.html" class="sidebar-link">redis实战-哨兵模式配置</a></li></ul></div></li></ul> </div> <div class="page"> <div class="content"><h1 id="rdb持久化"><a href="#rdb持久化" class="header-anchor">#</a> RDB持久化</h1> <p>RDB文件是经过<strong>压缩的二进制文件</strong>，可通过该文件还原成数据库状态。</p> <h2 id="rdb文件的创建与载入"><a href="#rdb文件的创建与载入" class="header-anchor">#</a> <strong>RDB文件的创建与载入</strong></h2> <p>有两个命令可用于生成RDB文件（SAVE和BGSAVE）。他们之间的区别是：SAVE会<strong>阻塞</strong>Redis服务器进程，直到RDB文件创建完毕为止，阻塞期间，服务器不能处理任何命令请求。而BGSAVE会<strong>fork出一个子进程</strong>，由子进程负责创建RDB文件，<strong>父进程继续处理命令请求</strong>。当子进程完成之后，向父进程<strong>发送信号</strong>。</p> <p>创建就是执行SAVE/BGSAVE底层调用rdbSave函数的过程，载入就是服务启动时读取RDB文件底层调用rdbLoad函数的过程。</p> <h3 id="rdb创建与载入时对过期键的处理套路"><a href="#rdb创建与载入时对过期键的处理套路" class="header-anchor">#</a> <strong>RDB创建与载入时对过期键的处理套路</strong></h3> <p>执行<code>SAVE</code>或<code>BGSAVE</code>时，创建一个新的RDB文件，程序回对数据库中键检查，已过期的就不会包含到RDB文件中。</p> <p>在启动时，RDB文件载入：</p> <ul><li>如果服务器以主服务模式运行，程序对文件保存的键检查，未过期的载入到数据库，过期则<strong>忽略</strong>。</li> <li>如果服务器以从服务模式运行，无论是否过期，<strong>都会载入</strong>到数据库。因为主服务器在数据同步时，会将从服务器的数据库清空，一般不会有影响。</li></ul> <h3 id="适用场景"><a href="#适用场景" class="header-anchor">#</a> <strong>适用场景</strong></h3> <ul><li>适合大规模的数据恢复</li> <li>对数据完整性和一致性要求不高</li></ul> <h3 id="缺陷"><a href="#缺陷" class="header-anchor">#</a> <strong>缺陷</strong></h3> <ul><li>在一定间隔时间做一次备份，所以如果redis挂了，就会<strong>丢失最后一次快照后的所有修改</strong>。</li> <li>fork的时候，内存中的数据被克隆一份，大致<strong>2倍的膨胀性</strong>需要考虑内存空间。</li></ul> <h3 id="bgsave执行时的服务器状态"><a href="#bgsave执行时的服务器状态" class="header-anchor">#</a> <strong>BGSAVE执行时的服务器状态</strong></h3> <p>BGSAVE命令执行期间，对SAVE，BGSAVE，BGREWRITEAOF（AOF持久化命令）三个命令的处理方式如下：</p> <p>由于SAVE，BGSAVE底层都是调用rdbSave来持久化文件的，而且父子进程同时执行两个rdbSave调用会<strong>产生竞态条件</strong>，所以这两个指令会被服务器拒绝。BGREWRITEAOF会被延迟到BGSAVE执行结束后执行。
如果BGREWRITEAOF正在执行，服务器会拒绝BGSAVE命令。由于BGREWRITEAOF和BGSAVE都会产生子进程且有大量的磁盘写入，出于性能考虑不会同时执行。</p> <p>简单来说，就是BGSAVE执行期间，<strong>拒绝SAVE，BGSAVE</strong>；<strong>延迟执行BGREWRITEAOF</strong>。BGREWRITEAOF执行期间，<strong>拒绝BGSAVE</strong>。</p> <h3 id="rdb与aof共存的载入情况"><a href="#rdb与aof共存的载入情况" class="header-anchor">#</a> <strong>RDB与AOF共存的载入情况</strong></h3> <p>RDB文件的载入是在服务器启动时执行，Redis并没有专门提供载入Redis的命令。由于AOF文件的更新频率更高，因此开启AOF持久化功能后，启动时<strong>优先加载AOF</strong>还原数据，只有在AOF处于关闭状态，才使用RDB文件恢复数据。</p> <h3 id="自动间隔性保存-save-time-count"><a href="#自动间隔性保存-save-time-count" class="header-anchor">#</a> <strong>自动间隔性保存</strong>(save [time] [count])</h3> <p>服务器允许用户通过配置文件设置隔一定时间自动执行BGSAVE。可通过save选项设多个保存条件，默认的配置如下：</p> <div class="language-c line-numbers-mode"><pre class="language-c"><code>save <span class="token number">900</span> <span class="token number">1</span>
save <span class="token number">300</span> <span class="token number">10</span>
save <span class="token number">60</span> <span class="token number">10000</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>只要满足任意条件，900s内对数据库进行1次修改或300s内...BGSAVE就会被执行。</p> <p>那么，服务器是如何根据save选项来自动执行BGSAVE的？
从实现角度考虑，我们需要<strong>记录配置</strong>、<strong>评判依据</strong>和<strong>依据更新驱动</strong>。记录配置由saveparams实现；评判依据是dirty计数器和lastsave属性；依据更新驱动就是serverCron对评判依据的动态更新。</p> <h4 id="save的实现"><a href="#save的实现" class="header-anchor">#</a> save的实现</h4> <p>save配置都会在redisServer的saveparam数组中体现：</p> <div class="language-c line-numbers-mode"><pre class="language-c"><code><span class="token keyword">struct</span> <span class="token class-name">redisServer</span><span class="token punctuation">{</span>
    <span class="token comment">//记录了保存条件的数组</span>
    <span class="token keyword">struct</span> <span class="token class-name">saveparam</span> <span class="token operator">*</span>saveparams<span class="token punctuation">;</span>
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token keyword">struct</span> <span class="token class-name">saveparam</span><span class="token punctuation">{</span>
    <span class="token comment">//秒数</span>
    <span class="token class-name">time_t</span> seconds<span class="token punctuation">;</span>
    <span class="token comment">//修改数</span>
    <span class="token keyword">int</span> changes<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><h4 id="dirty计数器和lastsave属性"><a href="#dirty计数器和lastsave属性" class="header-anchor">#</a> <strong>dirty计数器和lastsave属性</strong></h4> <p>这两个属性由redisServer持有：</p> <ul><li>dirty计数器记录距离上次成功执行SAVE或BGSAVE后数据库被修改了几次。</li> <li>lastsave是一个UNIX时间戳，记录上次成功执行SAVE或BGSAVE的时间。</li></ul> <div class="language-c line-numbers-mode"><pre class="language-c"><code><span class="token keyword">struct</span> <span class="token class-name">redisServer</span><span class="token punctuation">{</span>
    <span class="token comment">//修改计数器</span>
    <span class="token keyword">long</span> <span class="token keyword">long</span> dirty<span class="token punctuation">;</span>
    <span class="token comment">//上一次执行保存的时间</span>
    <span class="token class-name">time_t</span> lastsave<span class="token punctuation">;</span>
    <span class="token comment">//...</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p><strong>检查条件是否满足</strong></p> <p>Redis的周期性操作函数serverCron每隔100毫秒会执行一次，其中一项工作就是检查save选项设置的保存条件是否满足要求，满足则执行BGSAVE。</p> <h2 id="rdb文件结构"><a href="#rdb文件结构" class="header-anchor">#</a> <strong>RDB文件结构</strong></h2> <p><img src="data:image/jpeg;base64,/9j/4AAQSkZJRgABAQAAAQABAAD/2wBDAAMCAgICAgMCAgIDAwMDBAYEBAQEBAgGBgUGCQgKCgkICQkKDA8MCgsOCwkJDRENDg8QEBEQCgwSExIQEw8QEBD/wAALCAApAZEBAREA/8QAHQABAAEFAQEBAAAAAAAAAAAAAAcEBQYICgMCAf/EADcQAAAFAwIEBAUDBAEFAAAAAAECAwQFAAYHCBESGFiWExQh0yIxOHe1FSMyFkJRYRckNVNiY//aAAgBAQAAPwDbHTLpl03z2m7FE5O6fcbSMlI2RBO3jx3abBZdyuowRMoqooZITHOYwiYTCIiIiIjUm8p2ljppxV2bHezTlO0sdNOKuzY72acp2ljppxV2bHezTlO0sdNOKuzY72acp2ljppxV2bHezTlO0sdNOKuzY72acp2ljppxV2bHezTlO0sdNOKuzY72acp2ljppxV2bHezUZaZdMum+e03YonJ3T7jaRkpGyIJ28eO7TYLLuV1GCJlFVFDJCY5zGETCYREREREak3lO0sdNOKuzY72acp2ljppxV2bHezTlO0sdNOKuzY72acp2ljppxV2bHezTlO0sdNOKuzY72acp2ljppxV2bHezTlO0sdNOKuzY72acp2ljppxV2bHezTlO0sdNOKuzY72ajLTLpl03z2m7FE5O6fcbSMlI2RBO3jx3abBZdyuowRMoqooZITHOYwiYTCIiIiIjUm8p2ljppxV2bHezTlO0sdNOKuzY72acp2ljppxV2bHezTlO0sdNOKuzY72acp2ljppxV2bHezTlO0sdNOKuzY72acp2ljppxV2bHezTlO0sdNOKuzY72acp2ljppxV2bHezUZaZdMum+e03YonJ3T7jaRkpGyIJ28eO7TYLLuV1GCJlFVFDJCY5zGETCYREREREak3lO0sdNOKuzY72acp2ljppxV2bHezTlO0sdNOKuzY72acp2ljppxV2bHezTlO0sdNOKuzY72acp2ljppxV2bHezTlO0sdNOKuzY72acp2ljppxV2bHezTlO0sdNOKuzY72ajLTLpl03z2m7FE5O6fcbSMlI2RBO3jx3abBZdyuowRMoqooZITHOYwiYTCIiIiIjUm8p2ljppxV2bHezTlO0sdNOKuzY72acp2ljppxV2bHezTlO0sdNOKuzY72acp2ljppxV2bHezTlO0sdNOK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" alt="img"></p> <p>REDIS：长度5字节，保存&quot;REDIS&quot;5个字符（为书写方便，其实是5个单独字符），通过这个判断该文件是否为RDB文件。</p> <p>db_version：长度4字节，是字符串表示的整数记录RDB的版本号。</p> <p>database：包含0个或多个数据库及各数据库中键值对数据。表示那些数据库是有数据的。</p> <p>EOF：常量长度1字节，标志RDB文件正文的结束。读取时遇到该值，表示键值对的载入已经结束了。</p> <p>check_sum：是一个8字节的无符号整数，保存一个同过前几位变量计算出来的校验和。每次加载都会进行计算校验，通过这个来判断文件是否损坏。</p> <p><strong>database部分</strong></p> <p>每个非空数据库在RDB文件中都可表示为SELECTDB，db_number，key_value_pairs三部分</p> <ul><li>selectdb：1字节，标志位，标志着下一位存储的是数据库号码。</li> <li>db_number：是一个数据库号码。</li> <li>key_value_pairs：保存了数据库中所有键值对数据，如果有过期时间，则过期时间也会保存。</li></ul> <p><strong>key_value_pairs部分</strong></p> <p>不带过期时间的键值对在RDB文件由TYPE，key，value组成，带过期时间则含有EXPIRETIME_MS，ms：</p> <p><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAXsAAAAxCAAAAAAe4VZpAAAABGdBTUEAALGPC/xhBQAAACBjSFJNAAB6JgAAgIQAAPoAAACA6AAAdTAAAOpgAAA6mAAAF3CculE8AAAAAmJLR0QA/4ePzL8AABKXSURBVHja7Vx5lKVVcf9V3fstb+/u6YUZmIXZEIcZlJ0BQQZEGI2KOQJGlKOeBD1J0JMYzUmMkROSnKgHk6MxUY9rPIoCEtSIAmEZEGRnUBgWaXoW6GZmeu/33ve+795b+eN7a9M90zNJGJepv958d6v7u1V1q+pWD4kAAOEwveJEcqg5+N0lPtQM/A7TYewPHR3G/tDRYewPHR3G/tDRYewPHR3G/tDRYewPHem235JoOAAK4gAmBwLcXCEvQQDn0hnY1b8RwTkiQ1DNQSIQ4bYIjkSI4RyDGuF02uqEyQrBpWF2fQSj8YGdaGdAAEOIIAAEcABzozcEUG1ctrEpBKNUTVuPAHEKRCJirSgGYAGCsVAsAmoIpJ5hZgUY0s4AfsoVQSoAEUhBLKBVYzUARIADXC3UPsm+8wXt2CN+2ieGSzeQQLsa2mBskQXq/QDUnGYBIsCRQtXa0BliOKdVBVAMZwI/TjMXDMSs4gQqb1wM1BJArPUJsWUOpEIEK/WjBwBnAM1wApdoFdqklsBqmcgKiEFZoOKQJKAsAMDz4cYBCzjR7ABpHSIhDv09QZVzCtUpqJI45ZJa4ikCEsALk2Sv9qxAh5AKkGT9sarWEeCImIEQqFrYBBICzNA5yBQQOygPqKR4ZoEsYTTObr7Ed/u2Kh3Yb7laygydgcwA5GfN6NypngjQuiFQMYWeADFQKGZ5qhL1xxVhmCQbjDpkAiRRsTAtAMA+MO5nTA1eVyVSDOMAqkRFhRoyeriyJitQCi4GfAYAVwMCRmJBYSY7FFk/hAzu3ZBzUBqkAQESA0r3wQoiQE2Q2GxQBYRAqVj6DN03/bPpU4KY4AwoI/Al8QuGy4CnYGximFkErgqxgF++xTtJewOAkiSKgCzQpeAcZAoghvIheSCjoQLAoLFFTVjk3/zwm33jLxh7Ku7+5FKGs4AHWPI8DwjnwN6kei51ZfaUIDVPnmZjyBgHOKc1A1rBmcBLUrlXQKQ0BOQlxidkQgAmCQmWdPTJ3R/vIziB2Ka+udTsOEA8nYGLE7hr7v63owjMbSamwQtAIWAFTrRK2gWHGXEy/dWfXH0s18+ICIC1zAxYAZETRYR0NQbcxIdLn/WlzkZqX5gWlnd02FEjs5+eHXJPE+uOZ1gL+HjlSIcpH1mWo4L9bcwHnCe9pX12qqt6MOtzqINCWPDSVkpXUunZqbZh4PSHC03F1aFWQEO3FkhOtPC+d9Mxn/IUNSztYfp/pw7s2eOGRDhhgoBgWJSj9DcckZADQ0AiIHJWCwtZsAAkcOwUrNVEAkqUssY3OvachpO6AyLk2LJjiCMmOMuNBpssKKEtLEra5cMRWRgNJc4xC1K3x7E4UQyIbe5SrGi0xlrj0T4EjS25eTlywoCjeW5TAZsDw140p4xJApYUKIbETE4DMaAIzhKVlU8gMSQU5ZzE7BQlikASh5AogFEMqwVChJpjwJBtICzOegAJwXFMnHiWUgAknpGFqJyEkmnr6GBUrFQlF/smULAVowviJPYF7AwA1cSHkyTJtWM/hr59GBLfaCfzuSpkX9jZs1J1NEvTNREJJw8M+9bEtCfJKtTUosqUvyiZSHK5ygtFQpAPZC+VM8jnp0eBUHdlpoaDfNWNHzGwc0KHxMkKqT5dEsp1T+3oXwIzvnvp7hfzNinNnNTAfuKZYJ2HHSPL++zItura0uLY/19YOTH20T1Tzi8OrH/2ofXHxE9MH7/okWe5WF61Vp4YARD3nE5hs3fZtsUa9nvbPl04yHXNzMP3ZT5c7PjmZD5ADwB7jH1lx4oQu4+97OGvnf7+8uen/kTd971+wopzV03/cOcDp/RvWn7vjfHKSvWdp059Ye9JXt99b+26tTY+0rvqsSuP3PbAyPCxJ546dPW6j+WHvnzf3439YG2xK3hwVU+6Xxr/4vhnjqLrrr+m9+6bl4W3ZD6ROXjkAZjaHYXide94fOiqsZtmjokfuPtTi6p3l9Y/+P2PDwx+5+zF2J45re2kqrbNTwnO23nwp17cfOrXp7Kq/ZN1B3Qhz91Vui/5mw9y+KPh6NSHJyaimbMHvDNveO8y+4UbP5R9X+0v/9pnnPXgSWd5Wz6/bvHbfvwBp4aMe/7SlX/79pWPi9t48m17L9XRuqO3PrlqZLDr2OKdb19dm3ys7nWQO3Jp5enlgw8sffXUDX+0Ljnm/mzdDaaE2uyBi6a3Fnx6KXlNoTDz+EhSOqWn7qqrisxkW7xmKuZtfMdFuz4Tnnr5Vhs/8U/LvI23XnLMW+/9yj+++YdvXOaGdrjGrqC1oVrL/aGuGt81ktsUzNy8N+7f1Ed37lx+iv7J0yefNdMFIM7BoR4fjd366OvPeOreFy4+cectT+ZefWHWI9Vb7VUx3f/fV4SPP3jyhtzup2/P9J+2Np3eSai03bcNncecuYyvn3zhhLNDffkzd1x/3Hk50szIrHki8pTHWlHMPcVA9Swx3F9Mnh171wZ9Uk/A2jutQNAZrdinzDnX073nrCkE2WTq+sLFdbgIHLzllp0/Pae/XFixa7c75QoOGy3tF58LnvvXH9z20YeGbvLiG271yjds4bpxpc6Az4WvzeVmKksuC/UZXd/+2uaVPjn2XELdQGTvuOeoE4KmgBFldNtYJ/74j+40qHzn+fWnDX95Bn3frhH2PplHKeWntYrXuy2rVo5MBzLWd8VlD9+bOoNMxH2Du7xVpee88lfvuuQy9Y3nGlafaH86NY+KOLP91p+e85YljPyVf7XkqgwBGPTHnzwjm3gAAEUv3VN95KW3ZfDcT7xnL3+d5bMzylPepgIJZzyAdHbzP393x5W/nMlUb9tTfddxxmtOvvaBHw9e8UAo5917e37JhaU5U0ZJZvVrLy49/e7pz8FtW3NCaWNN5gxrxIRnZlH2Mid7pvudVx77ek60mr496x75fbLla586543d1JbiybV70JIZumrlh5ZEL97yiX531CfuPn/N5p3aDP/e8ZTMDnDyZ/xisob8u44xy5JfBvkHNtWDAPDSnOjFx91f2/7ER4L4uOefeJX1sDCaB3tKcsuOL4Z7esnuBU/3ivX5P5d7rzqTGSosF5JAqvaFbUceH8TF11zQ5VXjYq+zXig9AguJLSgJCm/4l4tL5dh4G/rvxo4ldZbIeXThly44Isuy9tjq9ie/+eGwoXzt+Q+2khR1UOrKmvCK7/97ef1mJymz0m6yQYq7ksiz8BxVu9af6LtEmWhm7Mj3rQa63juZTE6sqM9rmbyO4EUSSQZKUVB96aYZLDqiz/mXfm5o/MUPBMIAhKvdytUtg6HXfWXTzytHyciXyidXBlfwZNanchkeqb4uNtNeGA3fOyH9i5fCCcEpctgfzYM9q7UblmLP7Rfpvd/6yAv/8dFC1cu9dzn5HhzxJChRlDn93Dd8+faLdKbr1UvV9gffDU4masYjVP3RinbWItkYHC+eTqKulUV894OpaSHwEv91Y2dS90T0yDk9PT0PT7ZkrA17X3JBQXy/wl6V/9QO33jz5Q3cpL0faTjiUkY5pkANLPLJI+l700BeJ+SpzADrz/15rj6O6p5zUwHt8r+4qvoHXs/Sdy4VI4GfdK26bfQNPfWzZeNxw2Izrx64e+u5RSnHH1oawVGeXI0TCJCML7NxNlh0/onrtI484wCAF1B8Mw/2ycjUTAHPDftT/7BuY/meWy7w4t5akmGAyuXuXf15Nc3aLr70iyuWzrjBI2pP7YUdN33lWgZwY2R2eouTmV0nnW8fyelqXs3425+r80LYszO3+h3mrqE9pWvpNNlS7J07kWCmd4z00iiqE2Ofvfg4L1ubP5EyvFs/1buMEQ0Nd9PqPA2/OFRe1quSX40PHqFnnpg3r1J5vFb86J/ZE44779a1mdFtF6wO1ZnXZM+f6w5kmz/3715zCqSkHtrx6HX9x5zy0raXXrovf4bWax8fGdwSnrP8+K9flBscPmHTgvMxHdi7xinT1FPVayeggsqdk/0wvd9cvP6xrZPB+Scr7L1ucMfXjj591T3bJ3MbV71+y8Ytu//Llz3HWbXr/sEbT3szcN/W8aloxcZnBn9aOmbox/Fje5/6kVZSigTGA4RenNgxtHryV3p8xYmPPUnRmzxbtyXC0nIMKJkuTPas2XPk6j3LNjx8f3Xd2ezqeTNSnTIlO4bWPONWCk0/Ojk8upLkef5FiXrEbj/2Qd9hc9i8aiTuuDNk4o3+wCUjPd577nw2Lp24PJe4vuxZoWuEgaplNwhqw5VHZ6zre8vT3upPj3a5mup902IAvPkXLx51zUN+9fzVW0eWnLpU2zQDu39ns0M1trzn1jXpqvYFSxa2q3uXVyiakWQgnBjPRAN5QlKuRVIo6PFRr7Ao4VoVCnGlmPV4KvGg84CNqomX96I4LoZT1SwkTUgFISwDsR+XVU7H5coRGslo0teMe9wfj33Dn9vvmokDv3VVX/2zb/UtQKzEJYliqOZAy+7vb7upNH9SXWLzyzvf31N3UFztD7s/pQ8sg9agavCB4tWhUQt/O2k7kqWWGBC7IlYiR5CTrh7Hxmp4JeuIgULOYyLjhyKgfmusa8R4xg+ZgGxoYxTyCs4CChBniQHtuKQhursHgFoIhgBC/2ASfOJ5B1Zq6h69Z+/EsxuyCx8xH8XKHqy9J3JKBGSNAqCs0o6gHCvAxMTkSDS5hDVJmk5STImk+TYoOGESSyqb6lUqaDNDu1wWiLNHD4gidlYzuJlh2zcRy8I6dmKvDvDAeP1AYIsHJeizKMtT++/Uae9VI/lGCgTA80gBotKIkgFANTIAxNwcLiB4bVNKmu0moXqEIkC8c7A4CmhjWIPqSfKO+CNbng+sTtwzniwo6TYbRBLJ7weyFWhpilELyEXOQ8p2xSY5kLeTln7SXF+ps4WAObvPHlH/0XOhgAFbzyvSywYS7T8UrPdb0P5f1mt/b9ezWxe4ztzEtF9798rViIgFADjtkldszV9v6qgRKauRtekraKtIo+P0ZLY+1MtDqFkRwB1ZbEDS/JgBWDtKCD6RvOwaSvP3GglT2/BWqwjS1xkAQJLI7AoAafICEklfVetFJGi9LENUwVij0/nqr7TtdSjpai5tlZhMVECS6pk0GZW2rnUMpN6QLgpChNKLIMjC/RzqzpE0akRs63Nzo63Lm7jxpIwU8QTQGuLSNxaGs0T12pnG+y+LR3CzrTeARMCMOKqapsPZdvQGIAWJmdJHcTMWvTxqbP5bBGSbwBNBbKsOKLK5me468ATo9FTdbONXh2YmzIHhWpimotRUYXGQ+hsrOaTSkR6CqCiJwPtJK3TUKWToftEgBZj2wpwW4vVM4qjAVzARkJoPEwFBKgAMBIQoilw+SF8gIQBq6SuYi2Kd1lB13GI5E5FG8uzktV66mm5KMYAaUK1BLwqCchQZwG2duS5pNsd1zhojbDkIKJX2BHCA8hpyz7mxu4av6WPG9AQkABQjiYEsELlmJ24WfY3/vLRb5VStxqohZS6dOeWeFKQGMIN1VEMQGgfyAK5FE95z67E/ahcg+dnHomqCoAsyART8xnaidKkEqBiIACHgKUCAHIEZ5AG7gXwGHAB7BR6q1VrG99BQIgayIUBRDQQ/gDUNUXUWUHEVGh458TVsimS3ajxFVAUgmIkwDONIZyDjGdcdwjqQD8QCAVy1ISy2HIRWoP1Uc1MB8oGQ4XLxbs9ViVHsTUvdCMZAHFCPwWKACc4BWYAlCEdsPlOLSDWU1QpIASKiGF4GqKTnq6OaBKFtYp+UwnWbgv0UKnRgP/3UVCa1fxFAPOsRJgLyAeov25wWHY2muqAaVwGldXOUngcTYgsOAAvEpmFZG1OgMcIRmGHTB2GbHniGYQzYB2oCz4OkVVLMsDXAYxjbAKReh9cIR5sMpzaxLrQEJHGj+EU1cy6dt0tLG720XioBOl7V0oo8Mda1nKA6ALbdOC+IOrA3SoQbVw0B0mGw0olbVUh1thvVkE2nMQGYGnV99bvWtj9Zp5m+xnwOUNS4/ZgaFo6bmKbXt3C7ILsOD5DaOGjtp8FB/V80q1SzDqZDKzKR5h0nPDeSdexja1oPMvWZDxz7DnvvCcRB0utR8SwPtD45d3DfRK0eSChAU4OjDgdZTJNFr01AyUuhlea3ZlGpuIamUFotRyk86bFIq+51buzTstkmptImZy1PS1y7tLcGpzM7N3fkr0CqeZAWB0mdDoO0O5eEfaUkWpXGHXXDHZ9f1ml+krmmnb2azNNnHuxnT/ny1WbvkuboR/v80AnAgQVjh/++9tDR4b99OHR0GPtDR4exP3R0GPtDR/8XDwW/VvQb9N+i/NZhD/cbo8y/IWz+VtL/AJQ8Olz6LcszAAAAAElFTkSuQmCC" alt="img"></p> <p>EXPIRETIME_MS：标志位，长度为1字节，告知程序下一个读入的是以毫秒为单位的过期时间。
ms：是8字节长的带符号整数，记录UNIX时间戳，即过期时间。
type：记录value的类型，长度1字节，这个常量其实就是Redis对象类型和底层编码的组装：</p> <p>服务器会根据TYPE来决定如何读入和解释value的数据。</p> <p><strong>分析RDB文件</strong></p> <p>Redis自带RDB文件检查工具redis-check-dump。可以帮助在系统故障后分析快照文件，也就是RDB文件。</p> <blockquote><p>参考文章</p></blockquote> <ul><li>https://zhuanlan.zhihu.com/p/142591479</li></ul></div> <div class="page-edit"><div class="edit-link"><a href="https://github.com/caizongkai/vuepressDemo/edit/main/docs/md/database/Redis/one-Redis/Redis-02-RDB.md" target="_blank" rel="noopener noreferrer">帮助我们改善此页面！</a> <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></div> <!----></div> <div class="page-nav"><p class="inner"><span class="prev">
        ←
        <a href="/person-log.io/md/database/Redis/one-Redis/Redis-01-数据库.html" class="prev">
          Redis数据库
        </a></span> <span class="next"><a href="/person-log.io/md/database/Redis/one-Redis/Redis-03-AOF.html">
          AOF
        </a>
        →
      </span></p></div> </div> <!----></div></div>
    <script src="/person-log.io/assets/js/app.900e0138.js" defer></script><script src="/person-log.io/assets/js/18.d4bdd6a7.js" defer></script>
  </body>
</html>
