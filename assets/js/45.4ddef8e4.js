(window.webpackJsonp=window.webpackJsonp||[]).push([[45],{373:function(s,a,t){"use strict";t.r(a);var n=t(0),e=Object(n.a)({},(function(){this._self._c;return this._m(0)}),[function(){var s=this,a=s._self._c;return a("div",{staticClass:"content"},[a("h1",{attrs:{id:"docker镜像"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#docker镜像"}},[s._v("#")]),s._v(" Docker镜像")]),s._v(" "),a("blockquote",[a("p",[s._v("这个章节我们分为两部分去讲解")])]),s._v(" "),a("ul",[a("li",[a("p",[s._v("Docker镜像简介")])]),s._v(" "),a("li",[a("p",[s._v("Docker镜像详解")])])]),s._v(" "),a("h2",{attrs:{id:"docker镜像简介"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#docker镜像简介"}},[s._v("#")]),s._v(" Docker镜像简介")]),s._v(" "),a("p",[s._v("你可以把Docker镜像理解为一个类（Class），镜像里面包含了一个精简的操作系统（OS），同时包含了应用运行所需要的依赖包。")]),s._v(" "),a("h2",{attrs:{id:"docker镜像详解"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#docker镜像详解"}},[s._v("#")]),s._v(" Docker镜像详解")]),s._v(" "),a("p",[s._v("首先我们来看一下镜像和容器的关系，我们可以把镜像理解为构建时的结构，把容器理解为运行时的结构。容器是镜像的运行态，一个镜像可以运行多个容器。通常镜像都比较小，容器在构建镜像的时候通常都会裁剪掉不必要的不分。")]),s._v(" "),a("p",[s._v("镜像启动容器命令：")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" container run "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("image name"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("容器构建镜像命令：")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" commit "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("container id"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("image name"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("/"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("tag"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("h3",{attrs:{id:"拉取镜像"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#拉取镜像"}},[s._v("#")]),s._v(" 拉取镜像")]),s._v(" "),a("p",[s._v("拉取镜像我们可以用以下命令")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" image pull "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("image name"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(":"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("tag"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("如果版本号不写，默认拉取latest版本号的，注意：latest版本号的不一定是最新的。")]),s._v(" "),a("h3",{attrs:{id:"为镜像打标签"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#为镜像打标签"}},[s._v("#")]),s._v(" 为镜像打标签")]),s._v(" "),a("div",{staticClass:"language-java line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-java"}},[a("code",[s._v("docker tag "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token constant"}},[s._v("OPTIONS")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token constant"}},[s._v("IMAGE")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),a("span",{pre:!0,attrs:{class:"token constant"}},[s._v("TAG")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token constant"}},[s._v("REGISTRYHOST")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token constant"}},[s._v("USERNAME")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token constant"}},[s._v("NAME")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),a("span",{pre:!0,attrs:{class:"token constant"}},[s._v("TAG")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("h3",{attrs:{id:"查看镜像列表"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#查看镜像列表"}},[s._v("#")]),s._v(" 查看镜像列表")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 直接查看镜像")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" image "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("ls")]),s._v(" \n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 加过滤器")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" image "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("ls")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--filter")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("option"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# option可以为以下:")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# dangling:可以指定true或者false,仅返回悬虚镜像（true），或者非悬虚镜像")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# before:需要镜像名称或者ID作为参数，返回在之前被创建的全部镜像")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# since:和before相似，不过返回的是指定镜像之后创建的镜像")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# label:根据标柱的名称或者值进行过滤")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" image "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("ls")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--format")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("表达式"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br")])]),a("h3",{attrs:{id:"移除镜像"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#移除镜像"}},[s._v("#")]),s._v(" 移除镜像")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 普通移除镜像")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 注意：在依赖镜像的容器停止之前，无法使用该命令移除镜像，否则会报错")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" image "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("rm")]),s._v(" \n \n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 移除全部镜像")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" image "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("rm")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token variable"}},[a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$(")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" image "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("ls")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-q")]),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v(")")])]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-f")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 移除全部悬虚镜像")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" image prune\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 移除没有被使用过的镜像")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" image prune "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-a")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br")])]),a("h3",{attrs:{id:"搜索镜像"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#搜索镜像"}},[s._v("#")]),s._v(" 搜索镜像")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" search "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("name"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("h3",{attrs:{id:"镜像分层"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#镜像分层"}},[s._v("#")]),s._v(" 镜像分层")]),s._v(" "),a("p",[s._v("Docker镜像是由一些松耦合的只读镜像层组成，Dockerfile每一条操作指令都会构建一个镜像层，不同镜像之间可以共享镜像层，这样就可以提高性能了。")]),s._v(" "),a("p",[s._v("要查看Docker的镜像层可以用")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" image inspect "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("name"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(":"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("tag"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("h3",{attrs:{id:"镜像摘要"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#镜像摘要"}},[s._v("#")]),s._v(" 镜像摘要")]),s._v(" "),a("p",[s._v("当我们拉取了一个镜像，如果这个镜像出现了Bug，我们对这个镜像进行修复，然后把该镜像推送到远程仓库，用想通过的镜像名跟标签名，那么远程仓库的镜像会被覆盖，但是在生产环境中，我们有很多容器是依赖于这个镜像的，那么怎么区分这个镜像是新镜像还是旧镜像呢，因为他们有着相同的仓库名和标签名，这个时候镜像摘要就很关键了。")]),s._v(" "),a("p",[s._v("Docker会根据镜像层的内容为每一个镜像层赋值一个分发散列值，这是一个压缩版镜像的散列值，这个散列值跟内容有关，可以校验该镜像是否被篡改过。")]),s._v(" "),a("h3",{attrs:{id:"镜像的manifest列表"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#镜像的manifest列表"}},[s._v("#")]),s._v(" 镜像的Manifest列表")]),s._v(" "),a("p",[s._v("当我们在拉取镜像的时候，有些镜像可能是Linux系统，有一些镜像是Windows的，那么怎么保证我们拉取的镜像会适配我们的系统呢？其实这部分不用我们操心，Docker本身就有一个Mainfest列表，这个Mainfest列表指向了不同的镜像层配置，当我们拉取镜像的时候，Docker会获取我们主机的CPU架构，判断我们是什么系统，然后根据这个Mainfest列表调用不同的API获取不同的镜像，这一部分对我们操作人员来说是无感的。")])])}],!1,null,null,null);a.default=e.exports}}]);