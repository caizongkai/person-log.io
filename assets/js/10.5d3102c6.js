(window.webpackJsonp=window.webpackJsonp||[]).push([[10],{172:function(s,t,a){s.exports=a.p+"assets/img/image-20210202171922308.338766e3.png"},173:function(s,t,a){s.exports=a.p+"assets/img/image-20210202102332707.31cd1502.png"},174:function(s,t,a){s.exports=a.p+"assets/img/image-20210202155857416.cc069115.png"},175:function(s,t,a){s.exports=a.p+"assets/img/image-20210202160022920.e1bc8bde.png"},394:function(s,t,a){"use strict";a.r(t);var n=[function(){var s=this._self._c;return s("h1",{attrs:{id:"linux虚拟网络技术"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#linux虚拟网络技术"}},[this._v("#")]),this._v(" Linux虚拟网络技术")])},function(){var s=this._self._c;return s("h2",{attrs:{id:"network-namespace"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#network-namespace"}},[this._v("#")]),this._v(" Network Namespace")])},function(){var s=this._self._c;return s("p",[s("img",{attrs:{src:a(172),alt:"image-20210202171922308"}})])},function(){var s=this._self._c;return s("h3",{attrs:{id:"ip-netns命令"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#ip-netns命令"}},[this._v("#")]),this._v(" ip netns命令")])},function(){var s=this._self._c;return s("p",[this._v("可以借助"),s("code",[this._v("ip netns")]),this._v("(netns可以理解为network namespace的缩写)命令来完成对 Network Namespace 的各种操作。"),s("code",[this._v("ip netns")]),this._v("命令来自于"),s("code",[this._v("iproute2")]),this._v("安装包，一般系统会默认安装，如果没有的话，读者自行安装。")])},function(){var s=this._self._c;return s("p",[this._v("注意："),s("code",[this._v("ip netns")]),this._v("命令修改网络配置时需要 sudo 权限。")])},function(){var s=this._self._c;return s("p",[this._v("可以通过"),s("code",[this._v("ip netns")]),this._v("命令完成对Network Namespace 的相关操作，可以通过"),s("code",[this._v("ip netns help")]),this._v("查看命令帮助信息：")])},function(){var s=this,t=s._self._c;return t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("$ "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("ip")]),s._v(" netns "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("help")]),s._v("\nUsage: "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("ip")]),s._v(" netns list\n       "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("ip")]),s._v(" netns "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("add")]),s._v(" NAME\n       "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("ip")]),s._v(" netns "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("set")]),s._v(" NAME NETNSID\n       "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("ip")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("-all"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" netns delete "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("NAME"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n       "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("ip")]),s._v(" netns identify "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("PID"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n       "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("ip")]),s._v(" netns pids NAME\n       "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("ip")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("-all"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" netns "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("exec")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("NAME"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" cmd "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(".\n       "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("ip")]),s._v(" netns monitor\n       "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("ip")]),s._v(" netns list-id\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br")])])},function(){var s=this._self._c;return s("p",[this._v("默认情况下，Linux系统中是没有任何 Network Namespace的，所以"),s("code",[this._v("ip netns list")]),this._v("命令不会返回任何信息。")])},function(){var s=this._self._c;return s("h3",{attrs:{id:"创建network-namespace"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#创建network-namespace"}},[this._v("#")]),this._v(" 创建Network Namespace")])},function(){var s=this._self._c;return s("p",[this._v("下面，我们通过命令创建一个名为"),s("code",[this._v("ns0")]),this._v("的命名空间：")])},function(){var s=this,t=s._self._c;return t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("$ "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("ip")]),s._v(" netns "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("add")]),s._v(" ns0\n$ "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("ip")]),s._v(" netns list\nns0\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br")])])},function(){var s=this._self._c;return s("p",[this._v("新创建的 Network Namespace 会出现在"),s("code",[this._v("/var/run/netns/")]),this._v("目录下。如果相同名字的 namespace 已经存在，命令会报"),s("code",[this._v('Cannot create namespace file "/var/run/netns/ns0": File exists')]),this._v("的错误。")])},function(){var s=this._self._c;return s("h3",{attrs:{id:"操作network-namespace"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#操作network-namespace"}},[this._v("#")]),this._v(" 操作Network Namespace")])},function(){var s=this._self._c;return s("p",[s("code",[this._v("ip")]),this._v("命令提供了"),s("code",[this._v("ip netns exec")]),this._v("子命令可以在对应的 Network Namespace 中执行命令。")])},function(){var s=this._self._c;return s("p",[this._v("可以把新建的Network Namespace理解为一个空间，执行"),s("code",[this._v("ip netns exec")]),this._v("就相当于进入那个空间，然后后面再接对这个空间的操作的指令。比如：")])},function(){var s=this._self._c;return s("ol",[s("li",[this._v("查看新创建 Network Namespace 的网卡信息")])])},function(){var s=this,t=s._self._c;return t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ip netns exec ns0表示进入ns0的空间，ip addr表示查看该空间的网卡信息(旧命令的ifconfig)")]),s._v("\n$ "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("ip")]),s._v(" netns "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("exec")]),s._v(" ns0 "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("ip")]),s._v(" addr\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(": lo: "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("LOOPBACK"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" mtu "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("65536")]),s._v(" qdisc noop state DOWN group default qlen "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1000")]),s._v("\n    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br")])])},function(){var s=this._self._c;return s("p",[this._v("可以看到，新创建的Network Namespace中会默认创建一个"),s("code",[this._v("lo")]),this._v("回环网卡，此时网卡处于"),s("code",[this._v("关闭")]),this._v("状态。此时，尝试去 ping 该"),s("code",[this._v("lo")]),this._v("回环网卡，会提示"),s("code",[this._v("Network is unreachable")])])},function(){var s=this,t=s._self._c;return t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("$ "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("ip")]),s._v(" netns "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("exec")]),s._v(" ns0 "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("ping")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),s._v(".0.1\nconnect: Network is unreachable\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br")])])},function(){var s=this._self._c;return s("p",[this._v("通过下面的命令启用"),s("code",[this._v("lo")]),this._v("回环网卡：")])},function(){var s=this,t=s._self._c;return t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[s._v("ip")]),s._v(" netns "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("exec")]),s._v(" ns0 "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("ip")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("link")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("set")]),s._v(" lo up\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])])},function(){var s=this._self._c;return s("p",[this._v("然后再次尝试去 ping 该"),s("code",[this._v("lo")]),this._v("回环网卡：")])},function(){var s=this,t=s._self._c;return t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#-c 3：指定了ping的包数为3")]),s._v("\n$ "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("ip")]),s._v(" netns "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("exec")]),s._v(" ns0 "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("ping")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-c")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),s._v(".0.1\nPING "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),s._v(".0.1 "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),s._v(".0.1"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("56")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("84")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" bytes of data.\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("64")]),s._v(" bytes from "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),s._v(".0.1: "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("icmp_seq")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("ttl")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("64")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("time")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.048")]),s._v(" ms\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("64")]),s._v(" bytes from "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),s._v(".0.1: "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("icmp_seq")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("ttl")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("64")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("time")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.031")]),s._v(" ms\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("64")]),s._v(" bytes from "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),s._v(".0.1: "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("icmp_seq")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("ttl")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("64")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("time")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.029")]),s._v(" ms\n\n--- "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),s._v(".0.1 "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("ping")]),s._v(" statistics ---\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v(" packets transmitted, "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v(" received, "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("% packet loss, "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("time")]),s._v(" 1999ms\nrtt min/avg/max/mdev "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.029")]),s._v("/0.036/0.048/0.008 ms\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br")])])},function(){var s=this._self._c;return s("h3",{attrs:{id:"转移设备"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#转移设备"}},[this._v("#")]),this._v(" 转移设备")])},function(){var s=this._self._c;return s("h2",{attrs:{id:"veth-pair"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#veth-pair"}},[this._v("#")]),this._v(" veth pair")])},function(){var s=this._self._c;return s("p",[s("img",{attrs:{src:a(173),alt:"image-20210202102332707"}})])},function(){var s=this._self._c;return s("h3",{attrs:{id:"创建veth-pair"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#创建veth-pair"}},[this._v("#")]),this._v(" 创建veth pair")])},function(){var s=this,t=s._self._c;return t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("$ "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("ip")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("link")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("add")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("type")]),s._v(" veth\n$ "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("ip")]),s._v(" addr\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("61")]),s._v(": veth0@veth1: "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("BROADCAST,MULTICAST,M-DOWN"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" mtu "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1500")]),s._v(" qdisc noop state DOWN group default qlen "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1000")]),s._v("\n    link/ether e6:39:e1:e0:3a:a0 brd ff:ff:ff:ff:ff:ff\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("62")]),s._v(": veth1@veth0: "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("BROADCAST,MULTICAST,M-DOWN"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" mtu "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1500")]),s._v(" qdisc noop state DOWN group default qlen "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1000")]),s._v("\n    link/ether be:41:49:42:23:6a brd ff:ff:ff:ff:ff:ff\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br")])])},function(){var s=this,t=s._self._c;return t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#可以理解为add一个叫vethfoo的网卡，类型的veth，他的另一半的名字叫vethbar")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("ip")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("link")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("add")]),s._v(" vethfoo "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("type")]),s._v(" veth peer name vethbar\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br")])])},function(){var s=this._self._c;return s("h3",{attrs:{id:"实现network-namespace间通信"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#实现network-namespace间通信"}},[this._v("#")]),this._v(" 实现Network Namespace间通信")])},function(){var s=this._self._c;return s("p",[this._v("下面我们利用veth pair实现两个不同的 Network Namespace 之间的通信。刚才我们已经创建了一个名为"),s("code",[this._v("ns0")]),this._v("的 Network Namespace，下面再创建一个信息Network Namespace，命名为"),s("code",[this._v("ns1")])])},function(){var s=this,t=s._self._c;return t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("$ "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("ip")]),s._v(" netns "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("add")]),s._v(" ns1\n$ "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("ip")]),s._v(" netns list\nns1\nns0\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br")])])},function(){var s=this,t=s._self._c;return t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 设置网卡的Network Namespace")]),s._v("\n$ "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("ip")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("link")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("set")]),s._v(" veth0 netns ns0\n$ "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("ip")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("link")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("set")]),s._v(" veth1 netns ns1\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br")])])},function(){var s=this,t=s._self._c;return t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[s._v("ip")]),s._v(" netns "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("exec")]),s._v(" ns0 "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("ip")]),s._v(" addr\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(": lo: "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("LOOPBACK,UP,LOWER_UP"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" mtu "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("65536")]),s._v(" qdisc noqueue state UNKNOWN group default qlen "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1000")]),s._v("\n    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00\n    inet "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),s._v(".0.1/8 scope "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("host")]),s._v(" lo\n       valid_lft forever preferred_lft forever\n    inet6 ::1/128 scope "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("host")]),s._v(" \n       valid_lft forever preferred_lft forever\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("28")]),s._v(": veth0@if29: "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("BROADCAST,MULTICAST"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" mtu "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1500")]),s._v(" qdisc noop state DOWN group default qlen "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1000")]),s._v("\n    link/ether ba:80:f6:37:34:9f brd ff:ff:ff:ff:ff:ff link-netnsid "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br")])])},function(){var s=this,t=s._self._c;return t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("$ "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("ip")]),s._v(" netns "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("exec")]),s._v(" ns0 "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("ip")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("link")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("set")]),s._v(" veth0 up\n$ "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("ip")]),s._v(" netns "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("exec")]),s._v(" ns0 "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("ip")]),s._v(" addr "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("add")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("10.0")]),s._v(".1.1/24 dev veth0\n$ "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("ip")]),s._v(" netns "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("exec")]),s._v(" ns1 "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("ip")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("link")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("set")]),s._v(" veth1 up\n$ "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("ip")]),s._v(" netns "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("exec")]),s._v(" ns1 "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("ip")]),s._v(" addr "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("add")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("10.0")]),s._v(".1.2/24 dev veth1\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br")])])},function(){var s=this,t=s._self._c;return t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("$ "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("ip")]),s._v(" netns "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("exec")]),s._v(" ns0 "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("ip")]),s._v(" addr\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("61")]),s._v(": veth0@if62: "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("BROADCAST,MULTICAST,UP,LOWER_UP"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" mtu "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1500")]),s._v(" qdisc noqueue state UP group default qlen "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1000")]),s._v("\n    link/ether e6:39:e1:e0:3a:a0 brd ff:ff:ff:ff:ff:ff link-netnsid "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("\n    inet "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("10.0")]),s._v(".1.1/24 scope global veth0\n       valid_lft forever preferred_lft forever\n    inet6 fe80::e439:e1ff:fee0:3aa0/64 scope "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("link")]),s._v("\n       valid_lft forever preferred_lft forever\n\n$ "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("ip")]),s._v(" netns "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("exec")]),s._v(" ns1 "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("ip")]),s._v(" addr\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("62")]),s._v(": veth1@if61: "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("BROADCAST,MULTICAST,UP,LOWER_UP"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" mtu "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1500")]),s._v(" qdisc noqueue state UP group default qlen "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1000")]),s._v("\n    link/ether be:41:49:42:23:6a brd ff:ff:ff:ff:ff:ff link-netnsid "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("\n    inet "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("10.0")]),s._v(".1.2/24 scope global veth1\n       valid_lft forever preferred_lft forever\n    inet6 fe80::bc41:49ff:fe42:236a/64 scope "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("link")]),s._v("\n       valid_lft forever preferred_lft forever\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br")])])},function(){var s=this._self._c;return s("p",[this._v("从上面可以看出，我们已经成功启用了这个veth pair，并为每个veth设备分配了对应的ip地址。我们尝试在"),s("code",[this._v("ns1")]),this._v("中访问"),s("code",[this._v("ns0")]),this._v("中的ip地址：")])},function(){var s=this,t=s._self._c;return t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("$ "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("ip")]),s._v(" netns "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("exec")]),s._v(" ns1 "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("ping")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-c")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("10.0")]),s._v(".1.1\nsudo: unable to resolve "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("host")]),s._v(" zormshogu\nPING "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("10.0")]),s._v(".1.1 "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("10.0")]),s._v(".1.1"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("56")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("84")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" bytes of data.\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("64")]),s._v(" bytes from "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("10.0")]),s._v(".1.1: "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("icmp_seq")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("ttl")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("64")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("time")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.091")]),s._v(" ms\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("64")]),s._v(" bytes from "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("10.0")]),s._v(".1.1: "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("icmp_seq")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("ttl")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("64")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("time")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.035")]),s._v(" ms\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("64")]),s._v(" bytes from "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("10.0")]),s._v(".1.1: "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("icmp_seq")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("ttl")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("64")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("time")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.037")]),s._v(" ms\n\n--- "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("10.0")]),s._v(".1.1 "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("ping")]),s._v(" statistics ---\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v(" packets transmitted, "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v(" received, "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("% packet loss, "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("time")]),s._v(" 1999ms\nrtt min/avg/max/mdev "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.035")]),s._v("/0.054/0.091/0.026 ms\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br")])])},function(){var s=this._self._c;return s("h3",{attrs:{id:"veth查看对端"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#veth查看对端"}},[this._v("#")]),this._v(" veth查看对端")])},function(){var s=this._self._c;return s("p",[this._v("可以通过"),s("code",[this._v("ethtool")]),this._v("工具来查看（当Network Namespace很多时，操作会比较麻烦）：")])},function(){var s=this,t=s._self._c;return t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("$ "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("ip")]),s._v(" netns "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("exec")]),s._v(" ns1 "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("ethtool")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-S")]),s._v(" veth1\nNIC statistics:\n    peer_ifindex: "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("5")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br")])])},function(){var s=this,t=s._self._c;return t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("$ "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("ip")]),s._v(" netns "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("exec")]),s._v(" ns0 "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("ip")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("link")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("grep")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("5")]),s._v("\nveth0\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br")])])},function(){var s=this._self._c;return s("h2",{attrs:{id:"网桥"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#网桥"}},[this._v("#")]),this._v(" 网桥")])},function(){var s=this._self._c;return s("h3",{attrs:{id:"网桥的工作原理"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#网桥的工作原理"}},[this._v("#")]),this._v(" 网桥的工作原理")])},function(){var s=this._self._c;return s("p",[s("img",{attrs:{src:a(174),alt:"image-20210202155857416"}})])},function(){var s=this._self._c;return s("h3",{attrs:{id:"网桥的实现"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#网桥的实现"}},[this._v("#")]),this._v(" 网桥的实现")])},function(){var s=this._self._c;return s("p",[s("img",{attrs:{src:a(175),alt:"image-20210202160022920"}})])},function(){var s=this._self._c;return s("h3",{attrs:{id:"brctl"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#brctl"}},[this._v("#")]),this._v(" brctl")])},function(){var s=this._self._c;return s("div",{staticClass:"language-bash line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[this._v("# 创建网桥")]),this._v("\nbrctl addbr br0 \n")])]),this._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[this._v("1")]),s("br"),s("span",{staticClass:"line-number"},[this._v("2")]),s("br")])])},function(){var s=this._self._c;return s("div",{staticClass:"language-bash line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[this._v("# 删除网桥")]),this._v("\nbrctl delbr br0\n")])]),this._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[this._v("1")]),s("br"),s("span",{staticClass:"line-number"},[this._v("2")]),s("br")])])},function(){var s=this._self._c;return s("ol",[s("li",[this._v("建立一个逻辑网段之后，我们还需要为这个网段分配特定的端口。在Linux 中，一个端口实际上就是一个物理或虚拟网卡。而每个网卡的名称则分别为eth0 ，eth1 ，eth2 。我们需要把每个网卡一一和br0 这个网段联系起来，作为br0 中的一个端口。")])])},function(){var s=this,t=s._self._c;return t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 让eth0 成为br0 的一个端口")]),s._v("\nbrctl addif br0 eth0  \n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 让eth1 成为br0 的一个端口")]),s._v("\nbrctl addif br0 eth1\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 让eth2 成为br0 的一个端口")]),s._v("\nbrctl addif br0 eth2\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br")])])},function(){var s=this._self._c;return s("blockquote",[s("p",[this._v("参考文档：")])])}],e=a(0),r=Object(e.a)({},(function(){var s=this,t=s._self._c;return t("div",{staticClass:"content"},[s._m(0),s._v(" "),t("p",[s._v("由于作者最近在学习Docker网络，对Docker之间如何通信比较感兴趣，所以作为学习Docker网络的前置知识，我从网上查阅了资料并整理分享。")]),s._v(" "),t("p",[t("router-link",{attrs:{to:"./../Docker/Docker理论知识/Docker-06-Docker网络.html"}},[s._v("Docker网络")])],1),s._v(" "),s._m(1),s._v(" "),t("p",[s._v("Network Namespace 是 Linux 内核提供的功能，是实现网络虚拟化的重要功能，它能创建多个隔离的网络空间，它们有独自网络栈信息。但是不同的Network Namespace之间是不能通信的，如下图所示：")]),s._v(" "),s._m(2),s._v(" "),s._m(3),s._v(" "),s._m(4),s._v(" "),s._m(5),s._v(" "),s._m(6),s._v(" "),s._m(7),s._m(8),s._v(" "),s._m(9),s._v(" "),s._m(10),s._v(" "),s._m(11),s._m(12),s._v(" "),t("p",[s._v("对于每个 Network Namespace 来说，它会有自己独立的网卡、路由表、ARP 表、iptables 等和网络相关的资源。")]),s._v(" "),s._m(13),s._v(" "),s._m(14),s._v(" "),s._m(15),s._v(" "),s._m(16),s._v(" "),s._m(17),s._m(18),s._v(" "),s._m(19),s._m(20),s._v(" "),s._m(21),s._m(22),s._v(" "),s._m(23),s._m(24),s._v(" "),t("p",[s._v("我们可以在不同的 Network Namespace 之间转移设备（如veth）。由于一个设备只能属于一个 Network Namespace ，所以转移后在这个 Network Namespace 内就看不到这个设备了。")]),s._v(" "),t("p",[s._v("其中，veth设备属于可转移设备，而很多其它设备（如lo、vxlan、ppp、bridge等）是不可以转移的。")]),s._v(" "),s._m(25),s._v(" "),t("p",[s._v("veth pair 全称是 Virtual Ethernet Pair，是一个成对的端口，可以将两个Network Namespace 连接起来。如下图：")]),s._v(" "),s._m(26),s._v(" "),s._m(27),s._v(" "),s._m(28),t("p",[s._v("可以看到，此时系统中新增了一对veth pair，将veth0和veth1两个虚拟网卡连接了起来，此时这对 veth pair 处于”未启用“状态。")]),s._v(" "),t("p",[s._v("如果我们想指定 veth pair 两个端点的名称，可以使用下面的命令：")]),s._v(" "),s._m(29),s._m(30),s._v(" "),s._m(31),s._v(" "),s._m(32),t("p",[s._v("然后我们将veth0加入到ns0，将veth1加入到ns1，如下所示：")]),s._v(" "),s._m(33),t("p",[s._v("查看ns0命名空间的网卡：")]),s._v(" "),s._m(34),t("p",[s._v("可以看到空间里面的虚拟网卡veth0，他的状态是down。")]),s._v(" "),t("p",[s._v("然后我们分别为这对veth pair配置上ip地址，并启用它们：")]),s._v(" "),s._m(35),t("p",[s._v("查看这对veth pair的状态")]),s._v(" "),s._m(36),s._m(37),s._v(" "),s._m(38),t("p",[s._v("可以看到，veth pair成功实现了两个不同Network Namespace之间的网络交互。")]),s._v(" "),s._m(39),s._v(" "),s._m(40),s._v(" "),s._m(41),t("p",[s._v("得知另一端的接口设备序列号是5，我们再到另一个命名空间中查看序列号5代表什么设备：")]),s._v(" "),s._m(42),s._m(43),s._v(" "),t("p",[s._v("veth pair有一个明显的缺陷，就是只能实现两个网络接口之间的通信。如果我们想实现多个网络接口之间的通信，就可以使用下面介绍的网桥（Bridge）技术。简单来说，网桥就是把一台机器上的若干个网络接口“连接”起来。")]),s._v(" "),s._m(44),s._v(" "),t("p",[s._v("网桥对报文的转发基于MAC地址。网桥能够解析收发的报文，读取目标MAC地址的信息，和自己记录的MAC表结合，来决策报文的转发目标网口。(类似交换机)")]),s._v(" "),s._m(45),s._v(" "),s._m(46),s._v(" "),t("p",[s._v("Linux内核是通过一个虚拟的网桥设备（Net Device）来实现桥接的。这个虚拟设备可以绑定若干个以太网接口设备，从而将它们桥接起来。如下图所示：")]),s._v(" "),s._m(47),s._v(" "),t("p",[s._v("如上图所示，网桥设备 br0 绑定了 eth0 和 eth1。")]),s._v(" "),t("p",[s._v("对于网络协议栈的上层来说，只看得到 br0，上层协议栈需要发送的报文被送到 br0，网桥设备的处理代码判断报文该被转发到 eth0 还是 eth1，或者两者皆转发；反过来，从eth0 或 eth1 接收到的报文被提交给网桥的处理代码，在这里会判断报文应该被转发、丢弃还是提交到协议栈上层。")]),s._v(" "),s._m(48),s._v(" "),t("p",[s._v("和网桥有关的操作可以使用命令 brctl，这个命令来自 bridge-utils 这个包。")]),s._v(" "),t("p",[s._v("创建网桥")]),s._v(" "),s._m(49),t("p",[s._v("删除网桥")]),s._v(" "),s._m(50),t("p",[s._v("绑定网口")]),s._v(" "),s._m(51),s._v(" "),s._m(52),s._m(53),s._v(" "),t("p",[s._v("https://www.jianshu.com/p/f86d4b88777d")])])}),n,!1,null,null,null);t.default=r.exports}}]);