(window.webpackJsonp=window.webpackJsonp||[]).push([[90],{327:function(t,s,a){"use strict";a.r(s);var n=a(0),e=Object(n.a)({},(function(){this._self._c;return this._m(0)}),[function(){var t=this,s=t._self._c;return s("div",{staticClass:"content"},[s("h1",{attrs:{id:"rabbitmq集群"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#rabbitmq集群"}},[t._v("#")]),t._v(" RabbitMQ集群")]),t._v(" "),s("h2",{attrs:{id:"集群架构"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#集群架构"}},[t._v("#")]),t._v(" 集群架构")]),t._v(" "),s("h3",{attrs:{id:"普通集群-副本集群"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#普通集群-副本集群"}},[t._v("#")]),t._v(" 普通集群(副本集群)")]),t._v(" "),s("blockquote",[s("p",[t._v("All data/state required for the operation of a RabbitMQ broker is replicated across all nodes. An exception to this are message queues, which by default reside on one node, though they are visible and reachable from all nodes. To replicate queues across nodes in a cluster   --摘自官网")])]),t._v(" "),s("p",[s("code",[t._v("默认情况下:RabbitMQ代理操作所需的所有数据/状态都将跨所有节点复制。这方面的一个例外是消息队列，默认情况下，消息队列位于一个节点上，尽管它们可以从所有节点看到和访问")])]),t._v(" "),s("h4",{attrs:{id:"_1-架构图"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_1-架构图"}},[t._v("#")]),t._v(" 1.架构图")]),t._v(" "),s("p",[s("img",{attrs:{src:"picture/image-20200320094147471.png",alt:"image-20200320094147471"}})]),t._v(" "),s("p",[t._v("​\t核心解决问题:  "),s("code",[t._v("当集群中某一时刻master节点宕机,可以对Queue中信息,进行备份")])]),t._v(" "),s("h4",{attrs:{id:"_2-集群搭建"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_2-集群搭建"}},[t._v("#")]),t._v(" 2.集群搭建")]),t._v(" "),s("div",{staticClass:"language-bash line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 0.集群规划")]),t._v("\n\tnode1: "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("192.168")]),t._v(".245.134  mq1  master 主节点\n\tnode2: "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("192.168")]),t._v(".245.131  mq2  repl1  副本节点\n\tnode3: "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("192.168")]),t._v(".245.133  mq3  repl2  副本节点\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 1.克隆三台机器主机名和ip映射")]),t._v("\n\t"),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("vim")]),t._v(" /etc/hosts加入:\n\t\t "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("192.168")]),t._v(".245.134 mq1\n    \t"),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("192.168")]),t._v(".245.131 mq2\n    \t"),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("192.168")]),t._v(".245.133 mq3\n\tnode1: "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("vim")]),t._v(" /etc/hostname 加入:  mq1\n\tnode2: "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("vim")]),t._v(" /etc/hostname 加入:  mq2\n\tnode3: "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("vim")]),t._v(" /etc/hostname 加入:  mq3\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 2.三个机器安装rabbitmq,并同步cookie文件,在node1上执行:")]),t._v("\n\n\t"),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("chown")]),t._v(" rabbitmq:rabbitmq /var/lib/rabbitmq/.erlang.cookie\n\n\t"),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("scp")]),t._v(" /var/lib/rabbitmq/.erlang.cookie root@mq2:/var/lib/rabbitmq/\n\t"),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("scp")]),t._v(" /var/lib/rabbitmq/.erlang.cookie root@mq3:/var/lib/rabbitmq/\n\t\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 3.查看cookie是否一致:")]),t._v("\n\tnode1: "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("cat")]),t._v(" /var/lib/rabbitmq/.erlang.cookie \n\tnode2: "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("cat")]),t._v(" /var/lib/rabbitmq/.erlang.cookie \n\tnode3: "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("cat")]),t._v(" /var/lib/rabbitmq/.erlang.cookie \n\nsystemctl restart network\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 4.后台启动rabbitmq所有节点执行如下命令,启动成功访问管理界面:")]),t._v("\n\trabbitmq-server "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-deched")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 5.在node2和node3执行加入集群命令:")]),t._v("\n\t"),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v(".关闭       rabbitmqctl stop_app\n\t"),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("2")]),t._v(".重置\trabbitmqctl reset\n\t"),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("2")]),t._v(".加入集群    rabbitmqctl join_cluster rabbit@mq1\n\t"),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("3")]),t._v(".启动服务    rabbitmqctl start_app\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 6.查看集群状态,任意节点执行:")]),t._v("\n\trabbitmqctl cluster_status\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 7.如果出现如下显示,集群搭建成功:")]),t._v("\n\tCluster status of "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("node")]),t._v(" rabbit@mq3 "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("..")]),t._v(".\n\t"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("nodes,"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("disc,"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("rabbit@mq1,rabbit@mq2,rabbit@mq3"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(",\n\t"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("running_nodes,"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("rabbit@mq1,rabbit@mq2,rabbit@mq3"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(",\n\t"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("cluster_name,"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<<")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"rabbit@mq1"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">>")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(",\n\t"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("partitions,"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(",\n\t"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("alarms,"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("rabbit@mq1,"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(","),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("rabbit@mq2,"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(","),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("rabbit@mq3,"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 8.登录管理界面,展示如下状态:")]),t._v("\n")])]),t._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[t._v("1")]),s("br"),s("span",{staticClass:"line-number"},[t._v("2")]),s("br"),s("span",{staticClass:"line-number"},[t._v("3")]),s("br"),s("span",{staticClass:"line-number"},[t._v("4")]),s("br"),s("span",{staticClass:"line-number"},[t._v("5")]),s("br"),s("span",{staticClass:"line-number"},[t._v("6")]),s("br"),s("span",{staticClass:"line-number"},[t._v("7")]),s("br"),s("span",{staticClass:"line-number"},[t._v("8")]),s("br"),s("span",{staticClass:"line-number"},[t._v("9")]),s("br"),s("span",{staticClass:"line-number"},[t._v("10")]),s("br"),s("span",{staticClass:"line-number"},[t._v("11")]),s("br"),s("span",{staticClass:"line-number"},[t._v("12")]),s("br"),s("span",{staticClass:"line-number"},[t._v("13")]),s("br"),s("span",{staticClass:"line-number"},[t._v("14")]),s("br"),s("span",{staticClass:"line-number"},[t._v("15")]),s("br"),s("span",{staticClass:"line-number"},[t._v("16")]),s("br"),s("span",{staticClass:"line-number"},[t._v("17")]),s("br"),s("span",{staticClass:"line-number"},[t._v("18")]),s("br"),s("span",{staticClass:"line-number"},[t._v("19")]),s("br"),s("span",{staticClass:"line-number"},[t._v("20")]),s("br"),s("span",{staticClass:"line-number"},[t._v("21")]),s("br"),s("span",{staticClass:"line-number"},[t._v("22")]),s("br"),s("span",{staticClass:"line-number"},[t._v("23")]),s("br"),s("span",{staticClass:"line-number"},[t._v("24")]),s("br"),s("span",{staticClass:"line-number"},[t._v("25")]),s("br"),s("span",{staticClass:"line-number"},[t._v("26")]),s("br"),s("span",{staticClass:"line-number"},[t._v("27")]),s("br"),s("span",{staticClass:"line-number"},[t._v("28")]),s("br"),s("span",{staticClass:"line-number"},[t._v("29")]),s("br"),s("span",{staticClass:"line-number"},[t._v("30")]),s("br"),s("span",{staticClass:"line-number"},[t._v("31")]),s("br"),s("span",{staticClass:"line-number"},[t._v("32")]),s("br"),s("span",{staticClass:"line-number"},[t._v("33")]),s("br"),s("span",{staticClass:"line-number"},[t._v("34")]),s("br"),s("span",{staticClass:"line-number"},[t._v("35")]),s("br"),s("span",{staticClass:"line-number"},[t._v("36")]),s("br"),s("span",{staticClass:"line-number"},[t._v("37")]),s("br"),s("span",{staticClass:"line-number"},[t._v("38")]),s("br"),s("span",{staticClass:"line-number"},[t._v("39")]),s("br"),s("span",{staticClass:"line-number"},[t._v("40")]),s("br"),s("span",{staticClass:"line-number"},[t._v("41")]),s("br"),s("span",{staticClass:"line-number"},[t._v("42")]),s("br"),s("span",{staticClass:"line-number"},[t._v("43")]),s("br"),s("span",{staticClass:"line-number"},[t._v("44")]),s("br"),s("span",{staticClass:"line-number"},[t._v("45")]),s("br"),s("span",{staticClass:"line-number"},[t._v("46")]),s("br"),s("span",{staticClass:"line-number"},[t._v("47")]),s("br"),s("span",{staticClass:"line-number"},[t._v("48")]),s("br"),s("span",{staticClass:"line-number"},[t._v("49")]),s("br"),s("span",{staticClass:"line-number"},[t._v("50")]),s("br")])])])}],!1,null,null,null);s.default=e.exports}}]);